<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>üî¨ FenixLaboratory v2.4.2 - Experimentos y Proyectos</title>
  <meta name="description" content="Portfolio interactivo con juegos multijugador, guestbook art√≠stico y sistema de logros. Deadly Pursuer, Project Ankaro y m√°s." />
  <link rel="icon" type="image/png" href="public/assets/icons/ankush.png">
  
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff6b35">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="favicon.svg">
  
  <!-- Social Media -->
  <meta property="og:title" content="üî¨ FenixLaboratory - Experimentos y Proyectos">
  <meta property="og:description" content="Portfolio interactivo con juegos multijugador, guestbook art√≠stico y sistema de logros." />
  <meta property="og:image" content="https://thisisfenix.github.io/FenixLaboratory/preview.png">
  <meta property="og:url" content="https://thisisfenix.github.io/FenixLaboratory/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://thisisfenix.github.io/FenixLaboratory/preview.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;700&display=swap"
    rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <!-- Custom Styles -->
  <link rel="stylesheet" href="placeholder/styles.css">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
      <a class="navbar-brand" href="#"><i class="bi bi-code-square me-2"></i>FenixLaboratory</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="#proyectos"><i class="bi bi-code-slash me-1"></i> Proyectos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#comentarios"><i class="bi bi-chat-left-text me-1"></i> Comentarios</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#guestbook"><i class="bi bi-palette me-1"></i> Guestbook</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#deadly-pursuer"><i class="bi bi-controller me-1"></i> Deadly Pursuer</a>
          </li>
          <li class="nav-item">
            <button id="credits-btn" class="nav-link" aria-label="Ver cr√©ditos">
              <i class="bi bi-info-circle me-1"></i> Cr√©ditos
            </button>
          </li>
          <li class="nav-item">
            <button id="theme-panel-btn" class="nav-link" aria-label="Panel de temas">
              <i class="bi bi-palette me-1"></i> Temas
            </button>
          </li>
          <li class="nav-item">
            <button id="achievements-btn" class="nav-link" aria-label="Logros" style="white-space: nowrap; min-width: fit-content; display: flex; align-items: center; gap: 0.2rem; font-size: 0.8rem; padding: 0.3rem 0.5rem;">
              <i class="bi bi-trophy" style="font-size: 0.9rem;"></i> 
              <span id="points-display" style="font-weight: bold; font-size: 0.75rem;">0</span>
              <span class="streak-indicator" id="streak-indicator" style="margin-left: 0; font-size: 0.65rem;"></span>
            </button>
          </li>
          <li class="nav-item">
            <button id="updates-btn" class="nav-link" aria-label="Ver actualizaciones">
              <i class="bi bi-arrow-up-circle me-1"></i> v2.4.2
            </button>
          </li>
          <li class="nav-item">
            <button id="plushie-btn" class="nav-link" aria-label="Ver progreso de peluches">
              üß∏ <span id="plushie-progress" style="font-weight: bold;">0/40</span>
            </button>
          </li>
          <li class="nav-item">
            <button id="cupid-btn" class="nav-link" aria-label="Cupid's Arrow Game">
              üéπ <span id="cupid-score" style="font-weight: bold;">0</span>
            </button>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  
  <div class="main-content" id="main-content">
    <!-- Hero -->
    <section class="hero">
      <div class="container">
        <h1 id="typewriter">THISISFENIX LABORATORY</h1>
        <p>Donde subo mis experimentos raros y proyectos random</p>
        <a href="#proyectos" class="btn btn-neon" onclick="safeScrollIntoView('proyectos'); return false;"><i class="bi bi-arrow-down me-2"></i>Ver Proyectos</a>
      </div>
      <div class="particles" id="particles"></div>
    </section>



  <!-- Proyectos -->
  <section id="proyectos" class="container">
    <h2>PROYECTOS</h2>

    <!-- Filtros y B√∫squeda -->
    <div class="filters">
      <div class="row mb-3">
        <div class="col-md-6">
          <input type="text" class="form-control search-box" id="search-input" placeholder="Buscar proyectos..."
            aria-label="Buscar proyectos">
        </div>
        <div class="col-md-6">
          <select class="form-control search-box" id="sort-select" aria-label="Ordenar por">
            <option value="updated">M√°s recientes</option>
            <option value="stars">M√°s estrellas</option>
            <option value="name">Nombre A-Z</option>
            <option value="created">M√°s antiguos</option>
          </select>
        </div>
      </div>
      <div class="text-center">
        <button class="filter-btn active" data-filter="all">Todos</button>
        <button class="filter-btn" data-filter="javascript">JavaScript</button>
        <button class="filter-btn" data-filter="html">HTML</button>
        <button class="filter-btn" data-filter="css">CSS</button>
        <button class="filter-btn" data-filter="python">Python</button>
      </div>
    </div>

    <div id="repos-container">
      <!-- Skeleton loader mientras carga -->
      <div class="card">
        <div class="card-img-top skeleton"></div>
        <div class="card-body">
          <h3 class="card-title skeleton skeleton-text" style="width: 70%"></h3>
          <p class="card-text">
            <span class="skeleton skeleton-text"></span>
            <span class="skeleton skeleton-text"></span>
            <span class="skeleton skeleton-text" style="width: 80%"></span>
          </p>
          <div class="btn-group">
            <button class="btn btn-outline-neon skeleton" style="width: 100px;"></button>
            <button class="btn btn-outline-neon skeleton" style="width: 100px;"></button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-img-top skeleton"></div>
        <div class="card-body">
          <h3 class="card-title skeleton skeleton-text" style="width: 70%"></h3>
          <p class="card-text">
            <span class="skeleton skeleton-text"></span>
            <span class="skeleton skeleton-text"></span>
            <span class="skeleton skeleton-text" style="width: 80%"></span>
          </p>
          <div class="btn-group">
            <button class="btn btn-outline-neon skeleton" style="width: 100px;"></button>
            <button class="btn btn-outline-neon skeleton" style="width: 100px;"></button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-img-top skeleton"></div>
        <div class="card-body">
          <h3 class="card-title skeleton skeleton-text" style="width: 70%"></h3>
          <p class="card-text">
            <span class="skeleton skeleton-text"></span>
            <span class="skeleton skeleton-text"></span>
            <span class="skeleton skeleton-text" style="width: 80%"></span>
          </p>
          <div class="btn-group">
            <button class="btn btn-outline-neon skeleton" style="width: 100px;"></button>
            <button class="btn btn-outline-neon skeleton" style="width: 100px;"></button>
          </div>
        </div>
      </div>
    </div>

    <!-- Paginaci√≥n -->
    <div class="pagination" id="pagination">
      <!-- Se llenar√° din√°micamente -->
    </div>
  </section>

  <section id="comentarios" class="container">
    <h2>üí¨ COMENTARIOS</h2>
    <div class="giscus" style="background: var(--bg-light); padding: 2rem; border: 1px solid rgba(0, 240, 255, 0.1); border-radius: 8px;">
      <p style="text-align: center; margin-bottom: 2rem; color: var(--text-secondary);">
        üé® Deja tu mensaje, comparte una imagen, o simplemente saluda.<br>
        <small>Usa tu cuenta de GitHub para comentar</small>
      </p>
    </div>
  </section>

  <section id="guestbook" class="container">
    <h2>üé® GUESTBOOK</h2>
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card" style="text-align: center; padding: 2rem; position: relative; overflow: hidden;">
          <!-- Imagen de preview como fondo -->
          <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('guessbook/Preview-GuestBook.png'); background-size: cover; background-position: center; opacity: 0.1; z-index: 0;"></div>
          
          <div class="card-body" style="position: relative; z-index: 1;">
            <h3 class="card-title">üé® Guestbook de Dibujos v2.0.9</h3>
            <p class="card-text">
              ¬°Deja tu huella art√≠stica en el laboratorio! Sistema completo con rankings, 
              estad√≠sticas en tiempo real, likes y comentarios.
            </p>
            <div class="features-list" style="margin: 1.5rem 0; text-align: left;">
              <div>üèÜ <strong>Sistema de Rankings</strong> - Top dibujos por likes, comentarios y trazos</div>
              <div>üìä <strong>Estad√≠sticas Avanzadas</strong> - M√©tricas en tiempo real</div>
              <div>‚ù§Ô∏è <strong>Sistema Social</strong> - Likes, comentarios y galeria p√∫blica</div>
              <div>üé® <strong>50+ Herramientas</strong> - Pinceles, filtros, stickers y efectos</div>
              <div>üì± <strong>M√≥vil Optimizado</strong> - Touch events y responsive design</div>
              <div>üîÑ <strong>Tiempo Real</strong> - Firebase para actualizaciones instant√°neas</div>
            </div>
            <a href="guessbook/guestbook-new.html" class="btn btn-neon" style="position: relative; z-index: 2;">
              <i class="bi bi-palette me-2"></i>Abrir Guestbook v2.0
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="wiki" class="container">
    <h2>üìù WIKI DE PERSONAJES</h2>
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card" style="text-align: center; padding: 2rem; position: relative; overflow: hidden;">
          <div class="card-body" style="position: relative; z-index: 1;">
            <h3 class="card-title">üìù FenixLab: Archives of Creation</h3>
            <p class="card-text">
              Wiki colaborativa para personajes y mundos de la comunidad. Sistema completo con 
              formulario por pasos, galer√≠as y sistema de opiniones.
            </p>
            <div class="features-list" style="margin: 1.5rem 0; text-align: left;">
              <div>üé≠ <strong>Formulario Wizard</strong> - 5 pasos con animaciones fade</div>
              <div>üë• <strong>Personajes & Mundos</strong> - Sistema adaptativo seg√∫n tipo</div>
              <div>üñºÔ∏è <strong>Galer√≠as Completas</strong> - Iconos, renders, fanarts</div>
              <div>üí¨ <strong>Sistema de Opiniones</strong> - Selector din√°mico de personajes</div>
              <div>üì± <strong>Mobile First</strong> - Optimizado para todos los dispositivos</div>
              <div>üî• <strong>Firebase & Cloudinary</strong> - Almacenamiento en la nube</div>
            </div>
            <a href="wiki.html" class="btn btn-neon" style="position: relative; z-index: 2;">
              <i class="bi bi-book me-2"></i>Abrir Wiki
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="deadly-pursuer" class="container">
    <h2>üéÆ DEADLY PURSUER</h2>
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card deadly-pursuer-card" style="text-align: center; padding: 2rem; position: relative; overflow: hidden; background: #0a0a0a !important; border: 2px solid #ff0000 !important;">
          <!-- Imagen de preview como fondo -->
          <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('public/assets/loading-screen.png'); background-size: cover; background-position: center; opacity: 0.05; z-index: 0; filter: grayscale(100%) contrast(200%);"></div>
          
          <div class="card-body" style="position: relative; z-index: 1;">
            <h3 class="card-title" style="color: #ff0000 !important; text-shadow: 0 0 10px #ff0000;">‚ö†Ô∏è DEADLY PURSUER - ACCESO RESTRINGIDO</h3>
            <p class="card-text" style="color: #ff4444 !important;">
              ‚ö†Ô∏è ADVERTENCIA: Este juego contiene elementos perturbadores.<br>
              Una vez que entres, no podr√°s salir hasta completar la experiencia.
            </p>
            <div class="features-list" style="margin: 1.5rem 0; text-align: left; color: #ff6666 !important;">
              <div>üíÄ <strong style="color: #ff0000;">SUPERVIVENCIA EXTREMA</strong> - Sin garant√≠as de salida</div>
              <div>üî¥ <strong style="color: #ff0000;">EXPERIENCIA INMERSIVA</strong> - Realidad alterada</div>
              <div>‚ö†Ô∏è <strong style="color: #ff0000;">ACCESO √öNICO</strong> - Una sola oportunidad</div>
              <div>üö´ <strong style="color: #ff0000;">SIN RETORNO</strong> - El juego te elige</div>
            </div>
            <button onclick="showDeadlyPursuerWarning()" class="btn" style="background: #ff0000 !important; color: white !important; border: 2px solid #ff0000 !important; position: relative; z-index: 2; box-shadow: 0 0 20px #ff0000;">
              <i class="bi bi-exclamation-triangle me-2"></i>ACCEDER BAJO TU PROPIO RIESGO
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>
  </div>
  
  <div class="credits-section" id="credits-section">
    <div class="container">
      <h2 class="text-center mb-4">CR√âDITOS</h2>
      <div class="json-viewer" id="json-viewer">
        <div class="mini-loader"></div>
        <div class="loading-text">Cargando informaci√≥n...</div>
      </div>
    </div>
  </div>

  <div class="credits-section" id="updates-section">
    <div class="container">
      <h2 class="text-center mb-4">üöÄ ACTUALIZACIONES</h2>
      <div class="json-viewer" id="updates-viewer">
        <div class="mini-loader"></div>
        <div class="loading-text">Cargando actualizaciones desde updates.json...</div>
      </div>
    </div>
  </div>

  <div class="credits-section" id="achievements-section">
    <div class="container">
      <h2 class="text-center mb-4">üèÜ SISTEMA DE LOGROS</h2>
      <div class="json-viewer" id="achievements-viewer">
        <div class="row mb-3">
          <div class="col-md-3 col-6 mb-2">
            <div class="card text-center" style="padding: 0.75rem;">
              <div class="card-body" style="padding: 0;">
                <div class="points-badge mb-1" style="font-size: 0.7rem; padding: 0.2rem 0.4rem;">Puntos: <span id="total-points">0</span></div>
                <small class="text-muted" style="font-size: 0.65rem;">Total acumulado</small>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-6 mb-2">
            <div class="card text-center" style="padding: 0.75rem;">
              <div class="card-body" style="padding: 0;">
                <div class="points-badge mb-1" style="background: #dc2626; font-size: 0.7rem; padding: 0.2rem 0.4rem;">T√≠tulo: <span id="user-title">üî∞ Novato</span></div>
                <small class="text-muted" style="font-size: 0.65rem;">Rango actual</small>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-6 mb-2">
            <div class="card text-center" style="padding: 0.75rem;">
              <div class="card-body" style="padding: 0;">
                <div class="points-badge mb-1" style="background: #8b5cf6; font-size: 0.7rem; padding: 0.2rem 0.4rem;">Nivel: <span id="level-display">1</span></div>
                <small class="text-muted" style="font-size: 0.65rem;">Progreso</small>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-6 mb-2">
            <div class="card text-center" style="padding: 0.75rem;">
              <div class="card-body" style="padding: 0;">
                <div class="points-badge mb-1" id="streak-badge" style="background: #f97316; font-size: 0.7rem; padding: 0.2rem 0.4rem;">Racha: <span id="streak-display">0</span> d√≠as</div>
                <small class="text-muted" style="font-size: 0.65rem;">Consecutivos</small>
              </div>
            </div>
          </div>
        </div>
        <div class="mb-4" id="special-events"></div>
        <div class="mb-4" id="event-badge-container"></div>
        <div class="mb-3" style="display: flex; gap: 0.5rem;">
          <button onclick="toggleAchievementsView('achievements')" id="btn-view-achievements" class="btn btn-outline-neon" style="flex: 1; font-size: 0.8rem; padding: 0.5rem;">üéØ Ver Logros</button>
          <button onclick="toggleAchievementsView('leaderboard')" id="btn-view-leaderboard" class="btn btn-outline-neon" style="flex: 1; font-size: 0.8rem; padding: 0.5rem;">üèÜ Leaderboard</button>
        </div>
        <div id="achievements-view">
        <div class="row mb-3">
          <div class="col-md-6">
            <div id="daily-challenges"></div>
          </div>
          <div class="col-md-6">
            <div id="weekly-challenges"></div>
          </div>
        </div>
        <div class="mb-4" id="badges-display"></div>
        <div class="mb-4">
          <h4 style="color: var(--primary); margin-bottom: 1rem;">üéØ Todos los Logros</h4>
          <div id="achievements-list"></div>
        </div>
        </div>
        <div id="leaderboard-view" style="display: none;">
        <div class="mb-4">
          <h4 style="color: var(--primary); margin-bottom: 1rem;">üèÜ Leaderboard Global</h4>
          <div id="leaderboard-display"></div>
        </div>
        </div>
      </div>
    </div>
  </div>
  
  <button id="btn-top" aria-label="Volver arriba">
    <i class="bi bi-arrow-up"></i>
  </button>
  
  <button class="nerd-btn" id="nerd-btn" aria-label="Informaci√≥n t√©cnica">
    <i class="bi bi-terminal"></i>
  </button>
  
  <div class="panel-overlay" id="theme-overlay"></div>
  <div class="theme-panel" id="theme-panel">
    <button class="close-panel" id="close-theme-panel">&times;</button>
    <h3>üé® SELECTOR DE TEMAS</h3>
    
    <div class="theme-category">üåü Cl√°sicos</div>
    <div class="theme-grid">
      <div class="theme-card" data-theme="dark">
        <div class="theme-preview preview-dark"></div>
        <div class="theme-name">Oscuro</div>
      </div>
      <div class="theme-card" data-theme="light">
        <div class="theme-preview preview-light"></div>
        <div class="theme-name">Claro</div>
      </div>
      <div class="theme-card" data-theme="neon">
        <div class="theme-preview preview-neon"></div>
        <div class="theme-name">Ne√≥n</div>
      </div>
      <div class="theme-card" data-theme="funkyatlas">
        <div class="theme-preview preview-funkyatlas"></div>
        <div class="theme-name">FunkyAtlas</div>
      </div>
      <div class="theme-card seasonal-theme" data-theme="funkyatlas-christmas">
        <div class="theme-preview preview-funkyatlas-christmas"></div>
        <div class="theme-name">FunkyAtlas Xmas</div>
      </div>
    </div>

    <div class="theme-category">üöÄ Futuristas</div>
    <div class="theme-grid">
      <div class="theme-card" data-theme="cyberpunk">
        <div class="theme-preview preview-cyberpunk"></div>
        <div class="theme-name">Cyberpunk</div>
      </div>
      <div class="theme-card premium-theme" data-theme="cyberpunk2077" data-cost="800">
        <div class="theme-preview preview-cyberpunk2077"></div>
        <div class="theme-name">Cyberpunk 2077</div>
        <div class="theme-cost">800 pts</div>
      </div>
      <div class="theme-card" data-theme="matrix">
        <div class="theme-preview preview-matrix"></div>
        <div class="theme-name">Matrix</div>
      </div>
      <div class="theme-card premium-theme" data-theme="terminal-hacker" data-cost="600">
        <div class="theme-preview preview-terminal-hacker"></div>
        <div class="theme-name">Terminal Hacker</div>
        <div class="theme-cost">600 pts</div>
      </div>
      <div class="theme-card" data-theme="synthwave">
        <div class="theme-preview preview-synthwave"></div>
        <div class="theme-name">Synthwave</div>
      </div>
      <div class="theme-card premium-theme" data-theme="retro-synthwave" data-cost="700">
        <div class="theme-preview preview-retro-synthwave"></div>
        <div class="theme-name">Retro Synthwave</div>
        <div class="theme-cost">700 pts</div>
      </div>
    </div>

    <div class="theme-category">üåç Naturales</div>
    <div class="theme-grid">
      <div class="theme-card" data-theme="ocean">
        <div class="theme-preview preview-ocean"></div>
        <div class="theme-name">Oc√©ano</div>
      </div>
      <div class="theme-card" data-theme="forest">
        <div class="theme-preview preview-forest"></div>
        <div class="theme-name">Bosque</div>
      </div>
      <div class="theme-card" data-theme="sunset">
        <div class="theme-preview preview-sunset"></div>
        <div class="theme-name">Atardecer</div>
      </div>
    </div>

    <div class="theme-category">üéÑ √âpocas Especiales <span class="seasonal-indicator" id="seasonal-indicator"></span></div>
    <div class="mb-2">
      <label class="d-flex align-items-center" style="font-size: 0.8rem; color: var(--text-secondary);">
        <input type="checkbox" id="auto-seasonal" checked style="margin-right: 0.5rem;">
        Cambiar tema autom√°ticamente por fechas especiales
      </label>
    </div>
    <div class="mb-2">
      <label class="d-flex align-items-center" style="font-size: 0.8rem; color: var(--text-secondary);">
        <input type="checkbox" id="push-notifications" checked style="margin-right: 0.5rem;">
        Notificaciones de racha diaria
      </label>
    </div>
    <div class="mb-2">
      <label class="d-flex align-items-center" style="font-size: 0.8rem; color: var(--text-secondary);">
        <input type="checkbox" id="auto-day-night" style="margin-right: 0.5rem;">
        Modo autom√°tico d√≠a/noche
      </label>
    </div>
    <div class="theme-grid">
      <div class="theme-card seasonal-theme" data-theme="christmas">
        <div class="theme-preview preview-christmas"></div>
        <div class="theme-name">Navidad</div>
      </div>
      <div class="theme-card seasonal-theme" data-theme="halloween">
        <div class="theme-preview preview-halloween"></div>
        <div class="theme-name">Halloween</div>
      </div>
      <div class="theme-card seasonal-theme" data-theme="valentine">
        <div class="theme-preview preview-valentine"></div>
        <div class="theme-name">San Valent√≠n</div>
      </div>
      <div class="theme-card seasonal-theme" data-theme="easter">
        <div class="theme-preview preview-easter"></div>
        <div class="theme-name">Pascua</div>
      </div>
    </div>

    <div class="theme-category">üå§Ô∏è Estaciones</div>
    <div class="theme-grid">
      <div class="theme-card" data-theme="summer">
        <div class="theme-preview preview-summer"></div>
        <div class="theme-name">Verano</div>
      </div>
      <div class="theme-card" data-theme="autumn">
        <div class="theme-preview preview-autumn"></div>
        <div class="theme-name">Oto√±o</div>
      </div>
    </div>

    <div class="theme-category">üí∞ Temas Premium</div>
    <div class="theme-grid">
      <div class="theme-card premium-theme" data-theme="galaxy" data-cost="100">
        <div class="theme-preview preview-galaxy"></div>
        <div class="theme-name">Galaxia</div>
        <div class="theme-cost">100 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="gold" data-cost="150">
        <div class="theme-preview preview-gold"></div>
        <div class="theme-name">Oro</div>
        <div class="theme-cost">150 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="rainbow" data-cost="200">
        <div class="theme-preview preview-rainbow"></div>
        <div class="theme-name">Arco√≠ris</div>
        <div class="theme-cost">200 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="diamond" data-cost="300">
        <div class="theme-preview preview-diamond"></div>
        <div class="theme-name">Diamante</div>
        <div class="theme-cost">300 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="glassmorphism" data-cost="900">
        <div class="theme-preview preview-glassmorphism"></div>
        <div class="theme-name">Glassmorphism</div>
        <div class="theme-cost">900 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="pastel-kawaii" data-cost="500">
        <div class="theme-preview preview-pastel-kawaii"></div>
        <div class="theme-name">Pastel Kawaii</div>
        <div class="theme-cost">500 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="custom" data-cost="500">
        <div class="theme-preview preview-custom" id="custom-preview"></div>
        <div class="theme-name">Custom</div>
        <div class="theme-cost">500 pts</div>
      </div>
    </div>

    <div class="theme-category">üî• Temas √âpicos</div>
    <div class="theme-grid">
      <div class="theme-card premium-theme" data-theme="vaporwave" data-cost="400">
        <div class="theme-preview preview-vaporwave"></div>
        <div class="theme-name">Vaporwave</div>
        <div class="theme-cost">400 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="hacker" data-cost="500">
        <div class="theme-preview preview-hacker"></div>
        <div class="theme-name">Hacker Elite</div>
        <div class="theme-cost">500 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="neon-city" data-cost="600">
        <div class="theme-preview preview-neon-city"></div>
        <div class="theme-name">Ciudad Ne√≥n</div>
        <div class="theme-cost">600 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="space" data-cost="700">
        <div class="theme-preview preview-space"></div>
        <div class="theme-name">Espacio</div>
        <div class="theme-cost">700 pts</div>
      </div>
    </div>

    <div class="theme-category">‚ö° Temas Extremos</div>
    <div class="theme-grid">
      <div class="theme-card premium-theme" data-theme="fire" data-cost="800">
        <div class="theme-preview preview-fire"></div>
        <div class="theme-name">Fuego</div>
        <div class="theme-cost">800 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="ice" data-cost="900">
        <div class="theme-preview preview-ice"></div>
        <div class="theme-name">Hielo</div>
        <div class="theme-cost">900 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="toxic" data-cost="1000">
        <div class="theme-preview preview-toxic"></div>
        <div class="theme-name">T√≥xico</div>
        <div class="theme-cost">1000 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="royal" data-cost="1200">
        <div class="theme-preview preview-royal"></div>
        <div class="theme-name">Realeza</div>
        <div class="theme-cost">1200 pts</div>
      </div>
    </div>

    <div class="theme-category">üëë Temas Legendarios</div>
    <div class="theme-grid">
      <div class="theme-card premium-theme" data-theme="steampunk" data-cost="1500">
        <div class="theme-preview preview-steampunk"></div>
        <div class="theme-name">Steampunk</div>
        <div class="theme-cost">1500 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="hologram" data-cost="2000">
        <div class="theme-preview preview-hologram"></div>
        <div class="theme-name">Holograma</div>
        <div class="theme-cost">2000 pts</div>
      </div>
      <div class="theme-card premium-theme" data-theme="legendary" data-cost="5000">
        <div class="theme-preview preview-legendary"></div>
        <div class="theme-name">üèÜ LEGENDARIO</div>
        <div class="theme-cost">5000 pts</div>
      </div>
    </div>

    <div class="theme-category">üéÅ Temas Especiales</div>
    <div class="theme-grid">
      <div class="theme-card premium-theme" data-theme="plushie-rain" data-cost="0">
        <div class="theme-preview preview-plushie-rain"></div>
        <div class="theme-name">üß∏ Plushie Rain</div>
        <div class="theme-cost">Evento Exclusivo</div>
      </div>

      <div class="theme-card premium-theme" data-theme="valentines-love" data-cost="0">
        <div class="theme-preview preview-valentines-love"></div>
        <div class="theme-name">üíò Valentine's Love</div>
        <div class="theme-cost">Evento Exclusivo</div>
      </div>
    </div>

    <div class="theme-category">üé® Editor Avanzado</div>
    <div class="theme-editor" id="theme-editor" style="display: none;">
      <div class="editor-grid">
        <div class="editor-section">
          <h5>üé® Colores Base</h5>
          <div class="color-picker-grid">
            <div class="color-picker-item">
              <label>Fondo Principal:</label>
              <input type="color" id="editor-bg" value="#1a1a1a">
            </div>
            <div class="color-picker-item">
              <label>Fondo Secundario:</label>
              <input type="color" id="editor-bg-light" value="#2d2d2d">
            </div>
            <div class="color-picker-item">
              <label>Texto Principal:</label>
              <input type="color" id="editor-text" value="#f0f0f0">
            </div>
            <div class="color-picker-item">
              <label>Texto Secundario:</label>
              <input type="color" id="editor-text-sec" value="#b0b0b0">
            </div>
            <div class="color-picker-item">
              <label>Color Primario:</label>
              <input type="color" id="editor-primary" value="#ff6b35">
            </div>
            <div class="color-picker-item">
              <label>Color Secundario:</label>
              <input type="color" id="editor-secondary" value="#f7931e">
            </div>
          </div>
        </div>
        <div class="editor-section">
          <h5>‚ú® Efectos</h5>
          <label><input type="checkbox" id="editor-shadows"> Sombras</label><br>
          <label><input type="checkbox" id="editor-gradients"> Gradientes</label><br>
          <label><input type="checkbox" id="editor-animations"> Animaciones</label><br>
          <label><input type="range" id="editor-opacity" min="0.1" max="1" step="0.1" value="0.8"> Opacidad BG</label>
        </div>
      </div>
      <div class="editor-actions">
        <button class="btn btn-outline-neon" id="preview-theme">üëÅÔ∏è Vista Previa</button>
        <button class="btn btn-outline-neon" id="save-custom-theme">üíæ Guardar Tema</button>
        <button class="btn btn-outline-neon" id="reset-editor">üîÑ Resetear</button>
      </div>
    </div>
    <button class="btn btn-outline-neon" id="toggle-editor" style="width: 100%; margin-top: 1rem;">üé® Abrir Editor Avanzado</button>
  </div>
 
  <div class="parallax-bg" id="parallax-bg"></div>

  <div class="credits-mini-panel" id="credits-mini-panel">
    <button class="close-credits" id="close-credits">&times;</button>
    <h4>üé® Tema FunkyAtlas</h4>
    <p>Creado por <a href="https://funkyatlas.abelitogamer.com/" target="_blank">AbelitoGamer</a></p>
    <p>Sitio: <a href="https://funkyatlas.abelitogamer.com/" target="_blank">FunkyAtlas</a></p>
  </div>


  <!-- Notificaci√≥n de logro -->
  <div class="achievement-notification" id="achievement-notification">
    <div class="d-flex align-items-center gap-2">
      <i class="bi bi-trophy"></i>
      <div>
        <div class="fw-bold">¬°Logro desbloqueado!</div>
        <div id="notification-text"></div>
      </div>
    </div>
  </div>

  <div class="nerd-panel" id="name-panel">
    <button class="close-panel" id="close-name-panel">&times;</button>
    <h3>üèÜ LEADERBOARD</h3>
    <p>Ingresa tu nombre y foto de perfil para aparecer en el ranking global:</p>
    <input type="text" id="name-input" class="search-box" placeholder="Tu nombre" maxlength="20" style="width: 100%; margin-bottom: 1rem;">
    <div style="margin-bottom: 1rem;">
      <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.85rem;">üì∏ Foto de perfil:</label>
      <input type="file" id="avatar-file" accept="image/*" style="width: 100%; padding: 0.5rem; background: var(--bg-dark); border: 2px solid var(--primary); border-radius: 6px; color: var(--text-primary); cursor: pointer;">
      <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem;">
        üí° O pega una URL: <input type="url" id="avatar-input" class="search-box" placeholder="https://..." style="width: 100%; margin-top: 0.25rem;">
      </div>
    </div>
    <div id="avatar-preview" style="display: none; text-align: center; margin-bottom: 1rem;">
      <img id="preview-img" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary);" alt="Preview">
    </div>
    <div class="btn-group">
      <button class="btn btn-outline-neon" onclick="submitName()">üíæ Guardar</button>
      <button class="btn btn-outline-neon" onclick="hideNamePanel()">‚ùå Cancelar</button>
    </div>
  </div>
  
  <div class="panel-overlay" id="panel-overlay"></div>
  <div class="nerd-panel" id="nerd-panel">
    <button class="close-panel" id="close-panel">&times;</button>
    <h3>ü§ì INFO T√âCNICA</h3>
    <div class="nerd-info">üåê <strong>Navegador:</strong> <span id="browser-info"></span></div>
    <div class="nerd-info">üì± <strong>Dispositivo:</strong> <span id="device-info"></span></div>
    <div class="nerd-info">üñ•Ô∏è <strong>Resoluci√≥n:</strong> <span id="resolution-info"></span></div>
    <div class="nerd-info">üîß <strong>JavaScript:</strong> <span id="js-info"></span></div>
    <div class="nerd-info">üé® <strong>CSS:</strong> <span id="css-info"></span></div>
    <div class="nerd-info">üîå <strong>APIs:</strong> <span id="api-info"></span></div>
    <div class="nerd-info">üè† <strong>Hosting:</strong> <span id="hosting-info"></span></div>
    <div class="nerd-info">‚ö° <strong>Performance:</strong> <span id="performance-info"></span></div>
    <div class="nerd-info">üîç <strong>SEO:</strong> <span id="seo-info"></span></div>
    <div class="nerd-info">‚ôø <strong>Accesibilidad:</strong> <span id="accessibility-info"></span></div>
  </div>
  
  <!-- Indicador de sincronizaci√≥n -->
  <div class="sync-indicator" id="sync-indicator">
    <i class="bi bi-cloud-check"></i> Sincronizado
  </div>
  <footer class="footer">
    ¬© 2025 <a href="https://github.com/thisisfenix" target="_blank">FenixLaboratory</a>
  </footer>
  
  <!-- Giscus Comments -->
  <script src="https://giscus.app/client.js"
          data-repo="Thisisfenix/thisisfenix.github.io"
          data-repo-id="R_kgDOOxHAIg"
          data-category="General"
          data-category-id="DIC_kwDOOxHAIs4Crvbl"
          data-mapping="pathname"
          data-strict="0"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="bottom"
          data-theme="preferred_color_scheme"
          data-lang="es"
          crossorigin="anonymous"
          async>
  </script>
  
  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
  
  <!-- Firebase Scripts -->
  <script src="js/firebase-config.js"></script>
  
  <!-- Scripts -->
  <script src="js/achievements.js"></script>
  <script src="js/plushie-system.js"></script>
  <script src="js/cupid-arrow-game.js"></script>
  <script src="js/repos.js"></script>
  <script src="js/themes.js"></script>
  <script>
    // Deadly Pursuer Warning System
    function showDeadlyPursuerWarning() {
      const modal = document.createElement('div');
      modal.className = 'deadly-warning-modal';
      modal.style.display = 'flex';
      modal.innerHTML = `
        <div class="deadly-warning-content">
          <h3>‚ö†Ô∏è ADVERTENCIA FINAL ‚ö†Ô∏è</h3>
          <p style="color: #ff6666 !important;">¬øEst√°s seguro de que quieres continuar?<br><br>Una vez que entres, no podr√°s salir hasta completar la experiencia.</p>
          <div class="deadly-warning-buttons">
            <button class="deadly-btn" onclick="enterDeadlyPursuer()">S√ç</button>
            <button class="deadly-btn" onclick="closeDeadlyWarning()">NO</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    function closeDeadlyWarning() {
      const modal = document.querySelector('.deadly-warning-modal');
      if (modal) modal.remove();
    }
    
    function enterDeadlyPursuer() {
      const survivorNumber = Math.floor(Math.random() * 100) + 1;
      closeDeadlyWarning();
      
      const welcomeModal = document.createElement('div');
      welcomeModal.className = 'deadly-warning-modal';
      welcomeModal.style.display = 'flex';
      welcomeModal.innerHTML = `
        <div class="deadly-warning-content">
          <h3>üî¥ ACCESO CONCEDIDO</h3>
          <p style="color: #ff6666 !important;">Una vez ingresado ya no podr√°s salir.<br><br><strong style="color: #ff0000;">Bienvenido sobreviviente #${survivorNumber}</strong></p>
          <div class="deadly-warning-buttons">
            <button class="deadly-btn" onclick="finalizeEntry()">CONTINUAR</button>
          </div>
        </div>
      `;
      document.body.appendChild(welcomeModal);
    }
    
    function finalizeEntry() {
      closeDeadlyWarning();
      window.open('public/index.html', '_blank');
    }
    
    // Manejo de errores global optimizado
    const isMobile = /Mobi|Android/i.test(navigator.userAgent);
    
    window.addEventListener('error', function(e) {
      // Ignorar errores de im√°genes 404
      if (e.target && (e.target.tagName === 'IMG' || e.target.tagName === 'LINK')) {
        return true;
      }
      if (e.filename && !e.filename.includes('extension')) {
        console.error('Error:', e.error?.message || e.message);
        if (isMobile) {
          alert(`‚ùå Error: ${e.error?.message || e.message}\nArchivo: ${e.filename}\nL√≠nea: ${e.lineno}`);
        }
      }
      return true;
    }, true);
    
    window.addEventListener('unhandledrejection', function(e) {
      if (!e.reason?.message?.includes('extension')) {
        console.error('Promise rechazada:', e.reason);
        if (isMobile) {
          alert(`‚ùå Promise Error: ${e.reason}`);
        }
      }
      e.preventDefault();
    });
    
    // Optimizaci√≥n de rendimiento
    if ('requestIdleCallback' in window) {
      requestIdleCallback(() => {
        // Cargar funciones no cr√≠ticas cuando el navegador est√© idle
        setupLazyLoading();
        setupParallax();
      });
    }
    // Optimizaci√≥n de inicializaci√≥n
    document.addEventListener('DOMContentLoaded', () => {
      // Priorizar carga cr√≠tica
      loadGameData();
      checkDailyVisit();
      loadTheme();
      
      // Diferir carga no cr√≠tica
      setTimeout(() => {
        fetchRepos();
        typeWriterEffect();
        createParticles();
      }, 100);
      
      // Event listeners para navegaci√≥n
      const creditsBtn = document.getElementById('credits-btn');
      const updatesBtn = document.getElementById('updates-btn');
      const navbarBrand = document.querySelector('.navbar-brand');
      
      if (creditsBtn) {
        creditsBtn.addEventListener('click', showCredits);
      }
      
      if (updatesBtn) {
        updatesBtn.addEventListener('click', showUpdates);
      }
      
      if (navbarBrand) {
        navbarBrand.addEventListener('click', (e) => {
          e.preventDefault();
          showMainContent();
        });
      }
      
      // Verificar que todos los elementos necesarios existan
      const requiredElements = [
        'main-content', 'credits-section', 'updates-section',
        'theme-panel', 'nerd-panel'
      ];
      
      requiredElements.forEach(id => {
        const element = document.getElementById(id);
        if (!element) {
          console.warn(`Elemento requerido no encontrado: ${id}`);
        }
      });
      
      // Optimizar scroll performance
      let ticking = false;
      window.addEventListener('scroll', () => {
        if (!ticking) {
          requestAnimationFrame(() => {
            updateActiveNav();
            checkScrollToBottom();
            ticking = false;
          });
          ticking = true;
        }
      }, { passive: true });
    });
    
    // Inicializar sistema de logros
    const achievementSystem = new AchievementSystem('fenix-lab-game');
    const achievements = achievementSystem.achievements;
    const dailyChallenges = achievementSystem.dailyChallenges;
    const weeklyChallenges = achievementSystem.weeklyChallenges;
    const premiumThemes = achievementSystem.premiumThemes;
    const cursors = achievementSystem.cursors;
    const premiumEffects = achievementSystem.premiumEffects;
    
    // gameData como getter para siempre obtener la referencia actual
    Object.defineProperty(window, 'gameData', {
      get: () => achievementSystem.gameData
    });

    // Listener para notificaciones de logros
    window.addEventListener('achievement-unlocked', (e) => {
      showAchievementNotification(e.detail);
      updatePointsDisplay();
    });

    // Las funciones de repos ahora est√°n en repos.js

    function createParticles() {
      const container = document.getElementById('particles');
      const particleCount = 15;

      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');

        const size = Math.random() * 2 + 1;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100 + 100}%`;

        const duration = Math.random() * 10 + 10;
        particle.style.animationDuration = `${duration}s`;
        particle.style.animationDelay = `${Math.random() * 5}s`;

        container.appendChild(particle);
      }
    }

    const btnTop = document.getElementById('btn-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        btnTop.classList.add('visible');
      } else {
        btnTop.classList.remove('visible');
      }
    });

    btnTop.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Funci√≥n de scroll seguro
    function safeScrollIntoView(elementId, options = { behavior: 'smooth' }) {
      try {
        const element = typeof elementId === 'string' ? document.getElementById(elementId) : elementId;
        if (element && element.scrollIntoView && typeof element.scrollIntoView === 'function') {
          element.scrollIntoView(options);
          return true;
        } else {
          console.warn(`Elemento no encontrado o no tiene scrollIntoView: ${elementId}`);
          // Fallback: scroll manual
          if (element) {
            const rect = element.getBoundingClientRect();
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            window.scrollTo({
              top: scrollTop + rect.top - 100,
              behavior: 'smooth'
            });
            return true;
          }
          return false;
        }
      } catch (error) {
        console.error('Error en safeScrollIntoView:', error);
        return false;
      }
    }

    // Fix para navegaci√≥n suave - verificar elementos antes de scrollIntoView
    document.addEventListener('click', (e) => {
      const link = e.target.closest('a[href^="#"]');
      if (link) {
        const targetId = link.getAttribute('href').substring(1);
        if (targetId && targetId.length > 0) {
          e.preventDefault();
          // Verificar que el elemento existe antes de intentar scroll
          const targetElement = document.getElementById(targetId);
          if (targetElement) {
            safeScrollIntoView(targetId);
          } else {
            console.warn(`Elemento con ID '${targetId}' no encontrado`);
          }
        }
      }
    });

    function typeWriterEffect() {
      const title = document.getElementById('typewriter');
      if (!title) return;
      
      const text = "THISISFENIX LABORATORY";
      let i = 0;

      title.textContent = '';

      function type() {
        if (i < text.length) {
          title.textContent = text.substring(0, i + 1);
          i++;
          setTimeout(type, 80);
        }
      }

      type();
    }

    function buyCursor(cursor, cost) {
      const result = achievementSystem.buyCursor(cursor, cost);
      if (result) {
        updatePointsDisplay();
        updateCursorShop();
      }
      return result;
    }

    function updateActiveNav() {
      const sections = document.querySelectorAll('section');
      const navLinks = document.querySelectorAll('.nav-link:not(#theme-toggle)');

      sections.forEach(section => {
        const rect = section.getBoundingClientRect();
        if (rect.top <= 100 && rect.bottom >= 100) {
          const id = section.getAttribute('id');
          navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${id}`) {
              link.classList.add('active');
            }
          });
        }
      });
    }


    // Lazy loading para im√°genes
    function setupLazyLoading() {
      const images = document.querySelectorAll('img[loading="lazy"]');
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            img.classList.add('loaded');
            observer.unobserve(img);
          }
        });
      });

      images.forEach(img => imageObserver.observe(img));
    }

    // Funcionalidad del bot√≥n nerd
    function showNerdPanel() {
      // Detectar navegador real
      const ua = navigator.userAgent;
      let browserInfo = 'Desconocido';
      
      if (ua.includes('Edg/')) browserInfo = `Edge ${ua.match(/Edg\/(\d+)/)?.[1] || ''}`;
      else if (ua.includes('Chrome/') && !ua.includes('Edg')) browserInfo = `Chrome ${ua.match(/Chrome\/(\d+)/)?.[1] || ''}`;
      else if (ua.includes('Firefox/')) browserInfo = `Firefox ${ua.match(/Firefox\/(\d+)/)?.[1] || ''}`;
      else if (ua.includes('Safari/') && !ua.includes('Chrome')) browserInfo = `Safari ${ua.match(/Version\/(\d+)/)?.[1] || ''}`;
      
      // Detectar dispositivo y OS
      let deviceInfo = 'Escritorio';
      if (/iPhone|iPad|iPod/.test(ua)) deviceInfo = `iOS ${ua.match(/OS (\d+_\d+)/)?.[1]?.replace('_', '.') || ''}`;
      else if (/Android/.test(ua)) deviceInfo = `Android ${ua.match(/Android (\d+\.\d+)/)?.[1] || ''}`;
      else if (/Windows NT/.test(ua)) deviceInfo = `Windows ${ua.match(/Windows NT (\d+\.\d+)/)?.[1] || ''}`;
      else if (/Mac OS X/.test(ua)) deviceInfo = `macOS ${ua.match(/Mac OS X (\d+_\d+)/)?.[1]?.replace('_', '.') || ''}`;
      else if (/Linux/.test(ua)) deviceInfo = 'Linux';
      
      const resolution = `${screen.width}x${screen.height} (${window.innerWidth}x${window.innerHeight})`;
      
      // Detectar capacidades JavaScript
      const jsFeatures = [];
      if ('serviceWorker' in navigator) jsFeatures.push('Service Workers');
      if ('WebAssembly' in window) jsFeatures.push('WebAssembly');
      if ('fetch' in window) jsFeatures.push('Fetch API');
      if ('localStorage' in window) jsFeatures.push('LocalStorage');
      const jsInfo = jsFeatures.length > 0 ? jsFeatures.join(', ') : 'B√°sico';
      
      // Detectar capacidades CSS
      const cssFeatures = [];
      if (CSS.supports('display', 'grid')) cssFeatures.push('Grid');
      if (CSS.supports('display', 'flex')) cssFeatures.push('Flexbox');
      if (CSS.supports('backdrop-filter', 'blur(10px)')) cssFeatures.push('Backdrop Filter');
      if (CSS.supports('color', 'color(display-p3 1 0 0)')) cssFeatures.push('P3 Colors');
      const cssInfo = cssFeatures.length > 0 ? cssFeatures.join(', ') : 'B√°sico';
      
      // Detectar APIs disponibles
      const apis = [];
      if ('geolocation' in navigator) apis.push('Geolocation');
      if ('mediaDevices' in navigator) apis.push('Media Devices');
      if ('Notification' in window) apis.push('Notifications');
      if ('IntersectionObserver' in window) apis.push('Intersection Observer');
      const apiInfo = apis.length > 0 ? apis.join(', ') : 'Limitadas';
      
      // Detectar hosting
      const hostname = window.location.hostname;
      let hostingInfo = 'Local';
      if (hostname.includes('github.io')) hostingInfo = 'GitHub Pages';
      else if (hostname.includes('netlify')) hostingInfo = 'Netlify';
      else if (hostname.includes('vercel')) hostingInfo = 'Vercel';
      else if (hostname !== 'localhost' && hostname !== '127.0.0.1') hostingInfo = 'Servidor Web';
      
      // Detectar optimizaciones de performance
      const perfFeatures = [];
      if ('requestIdleCallback' in window) perfFeatures.push('Idle Callback');
      if ('IntersectionObserver' in window) perfFeatures.push('Lazy Loading');
      if ('serviceWorker' in navigator) perfFeatures.push('Service Worker');
      const perfInfo = perfFeatures.length > 0 ? perfFeatures.join(', ') : 'B√°sico';
      
      // Detectar caracter√≠sticas SEO
      const seoFeatures = [];
      if (document.querySelector('meta[property="og:title"]')) seoFeatures.push('Open Graph');
      if (document.querySelector('meta[name="description"]')) seoFeatures.push('Meta Description');
      if (document.querySelector('link[rel="canonical"]')) seoFeatures.push('Canonical');
      const seoInfo = seoFeatures.length > 0 ? seoFeatures.join(', ') : 'B√°sico';
      
      // Detectar accesibilidad
      const a11yFeatures = [];
      if (document.querySelector('[aria-label]')) a11yFeatures.push('ARIA Labels');
      if (document.querySelector('main, nav, header, footer')) a11yFeatures.push('Sem√°ntica HTML5');
      if (document.querySelector('[alt]')) a11yFeatures.push('Alt Text');
      const a11yInfo = a11yFeatures.length > 0 ? a11yFeatures.join(', ') : 'B√°sico';

      document.getElementById('browser-info').textContent = browserInfo;
      document.getElementById('device-info').textContent = deviceInfo;
      document.getElementById('resolution-info').textContent = resolution;
      document.getElementById('js-info').textContent = jsInfo;
      document.getElementById('css-info').textContent = cssInfo;
      document.getElementById('api-info').textContent = apiInfo;
      document.getElementById('hosting-info').textContent = hostingInfo;
      document.getElementById('performance-info').textContent = perfInfo;
      document.getElementById('seo-info').textContent = seoInfo;
      document.getElementById('accessibility-info').textContent = a11yInfo;

      document.getElementById('panel-overlay').classList.add('show');
      document.getElementById('nerd-panel').classList.add('show');
    }

    function hideNerdPanel() {
      document.getElementById('panel-overlay').classList.remove('show');
      document.getElementById('nerd-panel').classList.remove('show');
    }

    // Funcionalidad de cr√©ditos
async function showCredits() {
  try {
    hideAllSections();
    const creditsSection = document.getElementById('credits-section');
    if (creditsSection) {
      creditsSection.classList.add('active');
      creditsSection.style.display = 'block';
    }
    const response = await fetch('credits.json');
    const credits = await response.json();
    
    let html = `
      <div class="credit-header">
        <div class="credit-badge">üèÜ ${credits.version}</div>
        <h3>${credits["que es esto wey"]}</h3>
        <p>${credits.descripcion}</p>
        <div class="status-badge">${credits.estado} ‚Ä¢ ${credits.hosting}</div>
      </div>
    `;
    
    // Informaci√≥n del desarrollador
    if (credits.el_wey_que_hizo_esto) {
      const dev = credits.el_wey_que_hizo_esto;
      html += `
        <div class="credit-section">
          <h4>üë®üíª Desarrollador</h4>
          <div class="credit-item">
            <div class="developer-info">
              <img src="${dev.foto_perfil}" alt="${dev.quien_soy}" style="width: 60px; height: 60px; border-radius: 50%; float: left; margin-right: 1rem; object-fit: cover;">
              <div>
                <strong>${dev.quien_soy}</strong><br>
                <p style="font-size: 0.9rem; color: var(--text-secondary); margin: 0.5rem 0;">${dev.descripcion_personal}</p>
                <div class="social-links">
      `;
      if (dev.redes) {
        Object.entries(dev.redes).forEach(([platform, url]) => {
          const icon = platform === 'github' ? 'fab fa-github' : 
                      platform === 'twitter' ? 'fab fa-twitter' : 
                      platform === 'tiktok' ? 'fab fa-tiktok' : 'fas fa-link';
          html += `<a href="${url}" target="_blank" class="social-link"><i class="${icon}"></i> ${platform}</a>`;
        });
      }
      html += `</div></div><div style="clear: both;"></div></div></div></div>`;
    }
    
    // Caracter√≠sticas
    if (credits.que_hace) {
      html += `
        <div class="credit-section">
          <h4>‚ú® Caracter√≠sticas</h4>
          <div class="features-grid">
      `;
      credits.que_hace.forEach(feature => {
        html += `<div class="feature-item">‚Ä¢ ${feature}</div>`;
      });
      html += `</div></div>`;
    }
    
    // Cr√©ditos especiales
    if (credits.creditos) {
      html += `<div class="credit-section"><h4>üôè Cr√©ditos</h4>`;
      
      // Inspiraci√≥n con imagen
      if (credits.creditos.inspiracion) {
        const insp = credits.creditos.inspiracion;
        html += `
          <div class="credit-item">
            <div class="credit-key">Inspiraci√≥n:</div>
            <div class="credit-value">
              <img src="${insp.imagen}" alt="${insp.autor}" style="width: 60px; height: 60px; border-radius: 50%; float: left; margin-right: 1rem; object-fit: cover;">
              <div>
                <strong>${insp.autor}</strong><br>
                ${insp.texto}<br>
                <a href="${insp.url}" target="_blank" class="credit-link">Ver sitio original</a>
              </div>
              <div style="clear: both;"></div>
            </div>
          </div>
        `;
      }
      
      // Tecnolog√≠as
      if (credits.creditos.tecnologias) {
        const tech = credits.creditos.tecnologias;
        html += `
          <div class="credit-item">
            <div class="credit-key">Tecnolog√≠as:</div>
            <div class="credit-value">
              <strong>Frontend:</strong> ${tech.frontend.join(', ')}<br>
              <strong>Frameworks:</strong> ${tech.frameworks.join(', ')}<br>
              <strong>APIs:</strong> ${tech.apis.join(', ')}<br>
              <strong>Hosting:</strong> ${tech.hosting}<br>
              <strong>PWA:</strong> ${tech.pwa}<br>
              <strong>Fuentes:</strong> ${tech.fuentes}
            </div>
          </div>
        `;
      }

      // Testing
      if (credits.creditos.testing) {
        html += `<div class="credit-item"><div class="credit-key">Testing:</div><div class="credit-value">${credits.creditos.testing}</div></div>`;
      }
      
      html += `</div>`;
    }
    
    // Informaci√≥n legal
    if (credits.legal_stuff) {
      html += `
        <div class="credit-section">
          <h4>‚öñÔ∏è Legal</h4>
          <div class="credit-item">
            <div class="credit-key">Licencia:</div>
            <div class="credit-value">${credits.legal_stuff.licencia}</div>
          </div>
          <div class="credit-item">
            <div class="credit-key">Disclaimer:</div>
            <div class="credit-value">${credits.legal_stuff.disclaimer}</div>
          </div>
        </div>
      `;
    }
    
    // Bugs
    if (credits.bugs) {
      html += `
        <div class="credit-section">
          <h4>üêõ Estado de Bugs</h4>
          <div class="credit-item">
            <div class="credit-key">Bugs Graves:</div>
            <div class="credit-value">${credits.bugs.bugs_graves}</div>
          </div>
          <div class="credit-item">
            <div class="credit-key">Bugs Menores:</div>
            <div class="credit-value">${credits.bugs.bugs_menores}</div>
          </div>
          <div class="credit-item">
            <div class="credit-key">Features no planeadas:</div>
            <div class="credit-value">${credits.bugs.features_no_planeadas}</div>
          </div>
        </div>
      `;
    }
    
    // Planes futuros
    if (credits.planes_a_futuro) {
      html += `
        <div class="credit-section">
          <h4>üöÄ Planes Futuros</h4>
          <div class="future-plans">
      `;
      credits.planes_a_futuro.forEach(plan => {
        html += `<div class="plan-item">üîÆ ${plan}</div>`;
      });
      html += `</div></div>`;
    }

    // Mensaje final
    if (credits.mensaje_final) {
      html += `
        <div class="credit-section final-message">
          <div class="message-box">
            <i class="fas fa-heart"></i>
            <p>${credits.mensaje_final}</p>
          </div>
        </div>
      `;
    }
    
    document.getElementById('json-viewer').innerHTML = html;
  } catch (error) {
    document.getElementById('json-viewer').innerHTML = '<p style="color: var(--text-secondary);">Error al cargar credits.json: ' + error.message + '</p>';
  }
}

    function hideAllSections() {
      const mainContent = document.getElementById('main-content');
      const creditsSection = document.getElementById('credits-section');
      const updatesSection = document.getElementById('updates-section');
      const achievementsSection = document.getElementById('achievements-section');
      
      if (mainContent) mainContent.classList.add('hidden');
      if (creditsSection) {
        creditsSection.classList.remove('active');
        creditsSection.style.display = 'none';
      }
      if (updatesSection) {
        updatesSection.classList.remove('active');
        updatesSection.style.display = 'none';
      }
      if (achievementsSection) {
        achievementsSection.classList.remove('active');
        achievementsSection.style.display = 'none';
      }
    }
    
    function showMainContent() {
      hideAllSections();
      const mainContent = document.getElementById('main-content');
      if (mainContent) mainContent.classList.remove('hidden');
    }

    function hideCredits() {
      showMainContent();
    }

    async function showAchievements() {
      try {
        hideAllSections();
        const achievementsSection = document.getElementById('achievements-section');
        if (achievementsSection) {
          achievementsSection.classList.add('active');
          achievementsSection.style.display = 'block';
        }
        
        updatePointsDisplay();
        updateDailyChallengesDisplay();
        updateWeeklyChallengesDisplay();
        updateBadgesDisplay();
        updateSpecialEventsDisplay();
        if (typeof plushieSystem !== 'undefined' && plushieSystem) {
          plushieSystem.updateEventBadge();
        }
        toggleAchievementsView('achievements');
        await updateLeaderboardDisplay();
        
      } catch (error) {
        console.error('Error mostrando logros:', error);
      }
    }

    function toggleAchievementsView(view) {
      const achievementsView = document.getElementById('achievements-view');
      const leaderboardView = document.getElementById('leaderboard-view');
      const btnAchievements = document.getElementById('btn-view-achievements');
      const btnLeaderboard = document.getElementById('btn-view-leaderboard');
      
      if (view === 'achievements') {
        achievementsView.style.display = 'block';
        leaderboardView.style.display = 'none';
        btnAchievements.style.background = 'var(--primary)';
        btnAchievements.style.color = 'white';
        btnLeaderboard.style.background = '';
        btnLeaderboard.style.color = '';
      } else {
        achievementsView.style.display = 'none';
        leaderboardView.style.display = 'block';
        btnLeaderboard.style.background = 'var(--primary)';
        btnLeaderboard.style.color = 'white';
        btnAchievements.style.background = '';
        btnAchievements.style.color = '';
      }
    }

    async function showUpdates() {
      try {
        hideAllSections();
        const updatesSection = document.getElementById('updates-section');
        if (updatesSection) {
          updatesSection.classList.add('active');
          updatesSection.style.display = 'block';
        }
        
        const response = await fetch('updates.json');
        const data = await response.json();
        
        let html = `<div class="mb-3"><div class="points-badge" style="background: var(--primary);">Versi√≥n Actual: ${data.version}</div></div>`;
        
        // Todas las versiones en tarjetas
        html += '<h4 style="color: var(--primary); margin-bottom: 1rem;">üìù Historial de Versiones</h4>';
        html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 2rem;">';
        data.updates.forEach(update => {
          const typeColor = update.type === 'major' ? '#22c55e' : update.type === 'release' ? '#3b82f6' : update.type === 'new' ? '#ff6b35' : update.type === 'deprecated' ? '#dc2626' : '#6b7280';
          const isDeprecated = update.status === 'discarded';
          html += `
            <div class="credit-item" style="margin-bottom: 0; border: 2px solid ${typeColor}; border-radius: 12px; padding: 1.5rem; background: var(--bg-dark); ${isDeprecated ? 'opacity: 0.7; filter: grayscale(50%);' : ''}">
              <div class="credit-key" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <span style="background: ${typeColor}; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.7rem; font-weight: bold; color: white;">${update.type.toUpperCase()}</span>
                  <span style="font-size: 0.8rem; color: var(--text-secondary);">${update.date}</span>
                </div>
                <span style="font-size: 1.2rem; font-weight: bold;">v${update.version}</span>
              </div>
              <h5 style="color: ${typeColor}; margin-bottom: 1rem; font-size: 1.1rem;">${update.title}</h5>
              <ul class="credit-list" style="margin-bottom: 1rem;">
          `;
          
          update.features?.forEach(feature => {
            html += `<li style="font-size: 0.8rem;">${feature}</li>`;
          });
          
          if (update.fixes?.length) {
            update.fixes.forEach(fix => {
              html += `<li style="font-size: 0.8rem; color: #fbbf24;">${fix}</li>`;
            });
          }
          
          html += '</ul>';
          
          // Agregar howToInstall si existe
          if (update.howToInstall?.length) {
            html += '<h5 style="color: var(--secondary); margin: 1rem 0 0.5rem; font-size: 0.9rem;">üì± C√≥mo Instalar PWA:</h5><ul class="credit-list">';
            update.howToInstall.forEach(instruction => {
              html += `<li style="font-size: 0.8rem; color: #06b6d4;">${instruction}</li>`;
            });
            html += '</ul>';
          }
          
          // Agregar autoUpdate si existe
          if (update.autoUpdate?.length) {
            html += '<h5 style="color: var(--secondary); margin: 1rem 0 0.5rem; font-size: 0.9rem;">üîÑ Actualizaciones Autom√°ticas:</h5><ul class="credit-list">';
            update.autoUpdate.forEach(info => {
              html += `<li style="font-size: 0.8rem; color: #10b981;">${info}</li>`;
            });
            html += '</ul>';
          }
          
          html += '</div>';
        });
        html += '</div>'; // Cerrar grid
        
        // Roadmap
        if (data.roadmap?.length) {
          html += '<h4 style="color: var(--primary); margin-bottom: 1rem; margin-top: 2rem;">üó∫Ô∏è Pr√≥ximas Funciones</h4>';
          data.roadmap.forEach(item => {
            html += `
              <div class="credit-item" style="margin-bottom: 1rem; opacity: 0.8;">
                <div class="credit-key">${item.title}</div>
                <ul class="credit-list">
            `;
            item.features.forEach(feature => {
              html += `<li style="font-size: 0.8rem;">${feature}</li>`;
            });
            html += '</ul></div>';
          });
        }
        
        const updatesViewer = document.getElementById('updates-viewer');
        if (updatesViewer) updatesViewer.innerHTML = html;
      } catch (error) {
        const updatesViewer = document.getElementById('updates-viewer');
        if (updatesViewer) updatesViewer.innerHTML = '<p style="color: var(--text-secondary);">Error al cargar updates.json: ' + error.message + '</p>';
      }
    }

    function loadGameData() {
      achievementSystem.load();
      
      // Fix: Migraci√≥n de datos para usuarios existentes
      if (!gameData.specialEvents || typeof gameData.specialEvents !== 'object') {
        gameData.specialEvents = {
          'double-points': { active: false, endTime: null, multiplier: 2 },
          'theme-festival': { active: false, endTime: null, discount: 50 },
          'streak-boost': { active: false, endTime: null, bonus: 10 }
        };
        saveGameData();
      }
      
      // üîó Configurar listener para notificaciones del guestbook
      setupGuestbookListener();
      
      updatePointsDisplay();
      updateCursorShop();
    }

    // üîó Configurar listener para comunicaci√≥n con el guestbook
    function setupGuestbookListener() {
      // Listener para BroadcastChannel (comunicaci√≥n entre pesta√±as)
      if (window.BroadcastChannel) {
        const channel = new BroadcastChannel('fenix-achievements');
        channel.addEventListener('message', (event) => {
          handleGuestbookNotification(event.data);
        });
      }
      
      // Verificar notificaciones pendientes en localStorage
      checkPendingGuestbookNotifications();
      
      // Verificar peri√≥dicamente nuevas notificaciones
      setInterval(checkPendingGuestbookNotifications, 5000);
    }

    // üîó Manejar notificaciones del guestbook
    function handleGuestbookNotification(data) {
      if (data.source !== 'guestbook') return;
      
      console.log('üì® Notificaci√≥n recibida del guestbook:', data);
      
      switch (data.action) {
        case 'guestbook-visit':
          achievementSystem.markGuestbookVisit();
          break;
        case 'drawing-created':
          achievementSystem.updateGuestbookStats(1, 0, 0);
          addPoints(10); // Puntos por crear dibujo
          showAchievementNotification({ name: 'üé® Dibujo creado en el guestbook!', points: 10 });
          break;
        case 'comment-posted':
          achievementSystem.updateGuestbookStats(0, 1, 0);
          addPoints(5); // Puntos por comentar
          showAchievementNotification({ name: 'üí¨ Comentario en el guestbook!', points: 5 });
          break;
        case 'like-given':
          achievementSystem.updateGuestbookStats(0, 0, 1);
          addPoints(2); // Puntos por dar like
          showAchievementNotification({ name: '‚ù§Ô∏è Like dado en el guestbook!', points: 2 });
          break;
        case 'profile-updated':
          // Marcar que tiene perfil del guestbook
          localStorage.setItem('guestbook-has-profile', 'true');
          checkAchievement('social-butterfly');
          break;
      }
      
      updatePointsDisplay();
    }

    // üîó Verificar notificaciones pendientes del guestbook
    function checkPendingGuestbookNotifications() {
      try {
        const notifications = JSON.parse(localStorage.getItem('guestbook-notifications') || '[]');
        const processedIds = JSON.parse(localStorage.getItem('processed-guestbook-notifications') || '[]');
        
        notifications.forEach(notification => {
          const notificationId = `${notification.action}-${notification.timestamp}`;
          if (!processedIds.includes(notificationId)) {
            handleGuestbookNotification(notification);
            processedIds.push(notificationId);
          }
        });
        
        // Mantener solo los √∫ltimos 100 IDs procesados
        if (processedIds.length > 100) {
          processedIds.splice(0, processedIds.length - 100);
        }
        
        localStorage.setItem('processed-guestbook-notifications', JSON.stringify(processedIds));
      } catch (error) {
        console.warn('Error checking guestbook notifications:', error);
      }
    }

    function saveGameData() {
      achievementSystem.save();
    }

    function addPoints(points) {
      achievementSystem.addPoints(points);
      updatePointsDisplay();
    }

    function checkAchievement(id) {
      achievementSystem.checkAchievement(id);
    }

    function checkDailyVisit() {
      achievementSystem.checkDailyVisit();
      updatePointsDisplay();
    }

    function updateChallenge(id, increment) {
      achievementSystem.updateChallenge(id, increment);
    }

    function updateWeeklyChallenge(id, increment) {
      achievementSystem.updateWeeklyChallenge(id, increment);
    }

    function updateBadgeProgress(badgeId, progress) {
      achievementSystem.updateBadgeProgress(badgeId, progress);
    }

    function showAchievementNotification(achievement) {
      const notification = document.getElementById('achievement-notification');
      document.getElementById('notification-text').textContent = `${achievement.name} (+${achievement.points} pts)`;
      notification.classList.add('show');
      if (notification.hideTimeout) clearTimeout(notification.hideTimeout);
      notification.hideTimeout = setTimeout(() => notification.classList.remove('show'), 3000);
    }

    function updatePointsDisplay() {
      document.getElementById('points-display').textContent = gameData.points;
      const totalPoints = document.getElementById('total-points');
      if (totalPoints) totalPoints.textContent = gameData.points;
      const streakDisplay = document.getElementById('streak-display');
      if (streakDisplay) streakDisplay.textContent = gameData.streak;
      const levelDisplay = document.getElementById('level-display');
      if (levelDisplay) levelDisplay.textContent = gameData.level;
      const xpDisplay = document.getElementById('xp-display');
      if (xpDisplay) xpDisplay.textContent = `${gameData.experience}/${gameData.experienceToNext}`;
      updateStreakDisplay();
      updateTitle();
    }

    function updateStreakDisplay() {
      const indicator = document.getElementById('streak-indicator');
      if (gameData.streak > 0) {
        indicator.textContent = `üî•${gameData.streak}`;
        if (gameData.streak >= 7) indicator.classList.add('streak-fire');
      } else {
        indicator.textContent = '';
        indicator.classList.remove('streak-fire');
      }
    }

    function updateTitle() {
      const titleDisplay = document.getElementById('user-title');
      const title = achievementSystem.getTitle();
      if (titleDisplay) titleDisplay.textContent = title;
    }

    function updateDailyChallengesDisplay() {
      const container = document.getElementById('daily-challenges');
      if (!container) return;
      const today = new Date().toDateString();
      const todayChallenges = gameData.dailyChallenges[today] || {};
      let html = '<h5 style="color: var(--primary); margin-bottom: 0.5rem; font-size: 0.9rem;">üéØ Desaf√≠os Diarios</h5>';
      Object.entries(dailyChallenges).forEach(([id, challenge]) => {
        const progress = todayChallenges[id] || { completed: false, progress: 0 };
        const isCompleted = progress.completed;
        const progressText = challenge.target ? `${progress.progress}/${challenge.target}` : (isCompleted ? 'Completado' : 'Pendiente');
        html += `<div class="achievement-item ${isCompleted ? 'unlocked' : ''}" style="margin-bottom: 0.3rem; padding: 0.4rem;"><div class="achievement-icon" style="font-size: 0.9rem;">${isCompleted ? '‚úÖ' : 'üéØ'}</div><div class="achievement-info"><h4 style="font-size: 0.75rem;">${challenge.desc}</h4><p style="font-size: 0.65rem;">${progressText} - ${challenge.reward} pts</p></div></div>`;
      });
      container.innerHTML = html;
    }

    function updateWeeklyChallengesDisplay() {
      const container = document.getElementById('weekly-challenges');
      if (!container) return;
      const thisWeek = achievementSystem.getWeekString(new Date());
      const weekChallenges = gameData.weeklyChallenges[thisWeek] || {};
      let html = '<h5 style="color: var(--secondary); margin-bottom: 0.5rem; font-size: 0.9rem;">üìÖ Desaf√≠os Semanales</h5>';
      Object.entries(weeklyChallenges).forEach(([id, challenge]) => {
        const progress = weekChallenges[id] || { completed: false, progress: 0 };
        const isCompleted = progress.completed;
        const progressText = `${progress.progress}/${challenge.target}`;
        html += `<div class="achievement-item ${isCompleted ? 'unlocked' : ''}" style="margin-bottom: 0.3rem; padding: 0.4rem;"><div class="achievement-icon" style="font-size: 0.9rem;">${isCompleted ? 'üèÜ' : 'üìÖ'}</div><div class="achievement-info"><h4 style="font-size: 0.75rem;">${challenge.desc}</h4><p style="font-size: 0.65rem;">${progressText} - ${challenge.reward} pts</p></div></div>`;
      });
      container.innerHTML = html;
    }

    function setCursor(cursor) {
      if (!cursors[cursor]) cursor = 'default';
      gameData.activeCursor = cursor;
      document.body.style.cursor = cursors[cursor].css;
      saveGameData();
    }

    function updateCursorShop() {
      document.querySelectorAll('.cursor-item').forEach(item => {
        const cursor = item.dataset.cursor;
        const isUnlocked = gameData.unlockedCursors.has(cursor);
        
        if (isUnlocked) {
          item.classList.remove('locked');
          item.classList.add('owned');
        } else {
          item.classList.add('locked');
          item.classList.remove('owned');
        }
        
        if (gameData.activeCursor === cursor) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
    }

    // Notificaciones push
    async function requestNotificationPermission() {
      if ('Notification' in window && gameData.pushNotifications) {
        const permission = await Notification.requestPermission();
        if (permission === 'granted') {
          scheduleStreakReminder();
        }
      }
    }

    function scheduleStreakReminder() {
      if (!gameData.pushNotifications) return;
      
      const now = new Date();
      const tomorrow = new Date(now);
      tomorrow.setDate(tomorrow.getDate() + 1);
      tomorrow.setHours(20, 0, 0, 0); // 8 PM
      
      const timeUntilReminder = tomorrow.getTime() - now.getTime();
      
      setTimeout(() => {
        if (gameData.streak > 0 && gameData.lastVisit !== new Date().toDateString()) {
          const seasonalTheme = getSeasonalTheme();
          const message = seasonalTheme ? 
            `üéÉ ¬°No pierdas tu racha de ${gameData.streak} d√≠as! Tema ${seasonalTheme} te espera` :
            `üî• ¬°Mant√©n tu racha de ${gameData.streak} d√≠as viva!`;
          
          new Notification('FenixLaboratory', {
            body: message,
            icon: 'favicon.svg',
            badge: 'favicon.svg'
          });
        }
        scheduleStreakReminder(); // Programar para ma√±ana
      }, timeUntilReminder);
    }

    function checkDailyVisit() {
      const today = new Date().toDateString();
      const yesterday = new Date(Date.now() - 86400000).toDateString();
      
      if (gameData.lastVisit === today) {
        return;
      }
      
      if (gameData.lastVisit === yesterday) {
        // Visit√≥ ayer, continuar racha
        gameData.streak += 1;
        const streakPoints = Math.min(gameData.streak * 10, 100); // M√°ximo 100 pts por d√≠a
        addPoints(streakPoints);
        
        showAchievementNotification({
          name: `¬°Racha de ${gameData.streak} d√≠as!`,
          points: streakPoints
        });
        
        // Logros de racha
        if (gameData.streak === 3) checkAchievement('streak-starter');
        if (gameData.streak === 7) checkAchievement('streak-master');
        if (gameData.streak === 30) checkAchievement('streak-legend');
        
      } else if (gameData.lastVisit && gameData.lastVisit !== yesterday) {
        // Rompi√≥ la racha
        if (gameData.streak > 0) {
          showAchievementNotification({
            name: `Racha perdida despu√©s de ${gameData.streak} d√≠as`,
            points: 0
          });
        }
        gameData.streak = 1;
        addPoints(10);
      } else {
        // Primera visita
        gameData.streak = 1;
        addPoints(10);
      }
      
      gameData.lastVisit = today;
      
      // üóìÔ∏è SISTEMA DE RACHAS SEMANALES Y MENSUALES
      checkWeeklyVisit();
      checkMonthlyVisit();
      
      saveGameData();
    }
    
    function checkWeeklyVisit() {
      const today = new Date();
      const thisWeek = getWeekString(today);
      const lastWeek = getWeekString(new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000));
      
      if (gameData.lastWeeklyVisit === thisWeek) {
        return;
      }
      
      if (gameData.lastWeeklyVisit === lastWeek) {
        gameData.weeklyStreak += 1;
        const weeklyPoints = gameData.weeklyStreak * 25;
        addPoints(weeklyPoints);
        
        showAchievementNotification({
          name: `¬°Racha semanal de ${gameData.weeklyStreak} semanas!`,
          points: weeklyPoints
        });
        
        if (gameData.weeklyStreak === 4) checkAchievement('weekly-warrior');
        
      } else {
        gameData.weeklyStreak = 1;
        addPoints(25);
      }
      
      gameData.lastWeeklyVisit = thisWeek;
    }
    
    function checkMonthlyVisit() {
      const today = new Date();
      const thisMonth = `${today.getFullYear()}-${today.getMonth()}`;
      const lastMonth = `${today.getFullYear()}-${today.getMonth() - 1}`;
      
      if (gameData.lastMonthlyVisit === thisMonth) {
        return;
      }
      
      if (gameData.lastMonthlyVisit === lastMonth) {
        gameData.monthlyStreak += 1;
        const monthlyPoints = gameData.monthlyStreak * 50;
        addPoints(monthlyPoints);
        
        showAchievementNotification({
          name: `¬°Racha mensual de ${gameData.monthlyStreak} meses!`,
          points: monthlyPoints
        });
        
        if (gameData.monthlyStreak === 3) checkAchievement('monthly-champion');
        
      } else {
        gameData.monthlyStreak = 1;
        addPoints(50);
      }
      
      gameData.lastMonthlyVisit = thisMonth;
    }
    
    function getWeekString(date) {
      const year = date.getFullYear();
      const week = Math.ceil((date.getDate() - date.getDay() + 1) / 7);
      return `${year}-W${week}`;
    }

    function checkScrollToBottom() {
      if (!gameData.hasScrolledToBottom && (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
        gameData.hasScrolledToBottom = true;
        addPoints(5);
        checkAchievement('scroll-master');
        updateChallenge('scroll-bottom');
        saveGameData();
      }
    }

    function trackSearch() {
      gameData.searchCount++;
      addPoints(3);
      if (gameData.searchCount >= 5) {
        checkAchievement('search-explorer');
      }
      updateChallenge('use-search');
      updateWeeklyChallenge('search-expert');
      updateBadgeProgress('explorer', 1);
      saveGameData();
    }

    function trackFilter() {
      gameData.filterCount++;
      addPoints(2);
      if (gameData.filterCount >= 10) {
        checkAchievement('filter-expert');
      }
      updateBadgeProgress('explorer', 1);
      saveGameData();
    }

    function checkAchievement(id) {
      if (!gameData.achievements[id] && achievements[id]) {
        gameData.achievements[id] = true;
        addPoints(achievements[id].points);
        showAchievementNotification(achievements[id]);
        
        // üèÖ Actualizar badges relacionados
        if (id.includes('challenge')) updateBadgeProgress('challenge-champion', 1);
        if (id.includes('theme') || id.includes('customization')) updateBadgeProgress('theme-master', 1);
        if (id.includes('social')) updateBadgeProgress('social', 1);
        if (id.includes('time') || id.includes('marathon')) updateBadgeProgress('time-warrior', 1);
        if (id.includes('project') || id.includes('demo') || id.includes('code')) updateBadgeProgress('developer', 1);
        if (id.includes('search') || id.includes('filter') || id.includes('scroll')) updateBadgeProgress('explorer', 1);
        if (id.includes('collector') || id.includes('premium')) updateBadgeProgress('collector', 1);
        
        // üî• Sistema de combos - verificar logros recientes
        const recentAchievements = JSON.parse(localStorage.getItem('recent-achievements') || '[]');
        const now = Date.now();
        recentAchievements.push(now);
        const recentCount = recentAchievements.filter(time => now - time < 60000).length;
        
        if (recentCount >= 5 && !gameData.achievements['combo-master']) {
          setTimeout(() => checkAchievement('combo-master'), 100);
          showComboIndicator(recentCount);
        }
        
        localStorage.setItem('recent-achievements', JSON.stringify(recentAchievements.slice(-10)));
        
        saveGameData();
      }
    }

    function showAchievementNotification(achievement) {
      const notification = document.getElementById('achievement-notification');
      document.getElementById('notification-text').textContent = `${achievement.name} (+${achievement.points} pts)`;
      notification.classList.add('show');
      
      // Limpiar timeout anterior si existe
      if (notification.hideTimeout) {
        clearTimeout(notification.hideTimeout);
      }
      
      notification.hideTimeout = setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }
    
    function showComboIndicator(comboCount) {
      const indicator = document.createElement('div');
      indicator.className = 'combo-indicator';
      indicator.innerHTML = `üî• COMBO x${comboCount}!`;
      document.body.appendChild(indicator);
      
      setTimeout(() => {
        indicator.remove();
      }, 3000);
    }

    function setupParallax() {
      const parallaxBg = document.getElementById('parallax-bg');
      const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      if (!isMobile && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        window.addEventListener('scroll', () => {
          const scrolled = window.pageYOffset;
          const rate = scrolled * -0.5;
          parallaxBg.style.transform = `translateY(${rate}px)`;
        });
      }
    }

    function setupPageTransitions() {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      });

      document.querySelectorAll('section').forEach(section => {
        section.classList.add('page-transition');
        observer.observe(section);
      });
    }

    function setupAchievements() {
      const list = document.getElementById('achievements-list');
      Object.entries(achievements).forEach(([id, achievement]) => {
        const item = document.createElement('div');
        item.className = `achievement-item ${gameData.achievements[id] ? 'unlocked' : ''}`;
        item.innerHTML = `
          <div class="achievement-icon">${achievement.icon}</div>
          <div class="achievement-info">
            <h4>${achievement.name}</h4>
            <p>${achievement.desc} (+${achievement.points} pts)</p>
          </div>
        `;
        list.appendChild(item);
      });
    }

    function checkTimeBasedAchievements() {
      const hour = new Date().getHours();
      const day = new Date().getDay();
      if (hour >= 0 && hour < 6) checkAchievement('night-owl');
      if (hour < 7) {
        checkAchievement('early-bird');
        updateChallenge('visit-morning');
      }
      if (day === 6) gameData.weekendVisits.saturday = true;
      if (day === 0) gameData.weekendVisits.sunday = true;
      if (gameData.weekendVisits.saturday && gameData.weekendVisits.sunday) {
        checkAchievement('weekend-warrior');
      }
    }

    function trackFastClicks() {
      const now = Date.now();
      if (now - gameData.lastClickTime < 3000) {
        gameData.fastClicks++;
        if (gameData.fastClicks >= 5) {
          checkAchievement('speed-demon');
          gameData.fastClicks = 0;
        }
      } else {
        gameData.fastClicks = 1;
      }
      gameData.lastClickTime = now;
      saveGameData();
    }

    // Efectos premium
    function buyEffect(effectId) {
      const effect = premiumEffects[effectId];
      if (!effect) return false;
      
      if (gameData.points >= effect.cost) {
        achievementSystem.gameData.points -= effect.cost;
        achievementSystem.gameData.activeEffects[effectId] = Date.now() + effect.duration;
        achievementSystem.save();
        updatePointsDisplay();
        
        if (effectId === 'matrix-rain') activateMatrixRain();
        if (effectId === 'mouse-particles') activateMouseParticles();
        
        showAchievementNotification({ name: `Efecto ${effect.name} activado!`, points: 0 });
        return true;
      }
      return false;
    }

    function activateMatrixRain() {
      const canvas = document.createElement('canvas');
      canvas.id = 'matrix-canvas';
      canvas.style.cssText = 'position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:-1';
      document.body.appendChild(canvas);
      
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      const chars = 'function(){return Math.random();}console.log("Hello World");if(true){code=awesome;}for(let i=0;i<10;i++){}';
      const drops = Array(Math.floor(canvas.width/20)).fill(1);
      
      const draw = () => {
        ctx.fillStyle = 'rgba(0,0,0,0.05)';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = '#00ff00';
        ctx.font = '12px "Courier New", monospace';
        
        drops.forEach((y,i) => {
          const char = chars[Math.floor(Math.random()*chars.length)];
          ctx.fillText(char, i*20, y*20);
          if(y*20 > canvas.height && Math.random() > 0.975) drops[i] = 0;
          drops[i]++;
        });
      };
      
      const interval = setInterval(draw, 33);
      setTimeout(() => {
        clearInterval(interval);
        canvas.remove();
      }, gameData.activeEffects['matrix-rain'] - Date.now());
    }

    // Activar Matrix Rain autom√°ticamente en tema Matrix
    function checkMatrixTheme() {
      if (document.body.classList.contains('matrix-theme')) {
        if (!document.getElementById('matrix-canvas')) {
          gameData.activeEffects['matrix-rain'] = Date.now() + 300000; // 5 minutos
          activateMatrixRain();
        }
      }
    }

    let mouseParticleActive = false;
    function activateMouseParticles() {
      mouseParticleActive = true;
      const handler = (e) => {
        if (!mouseParticleActive) return;
        if (Math.random() < 0.3) {
          const particle = document.createElement('div');
          particle.style.cssText = `
            position:fixed;width:4px;height:4px;background:var(--primary);
            border-radius:50%;left:${e.clientX}px;top:${e.clientY}px;
            pointer-events:none;z-index:9999;animation:fadeOut 1s ease-out forwards;
          `;
          document.body.appendChild(particle);
          setTimeout(() => particle.remove(), 1000);
        }
      };
      
      document.addEventListener('mousemove', handler);
      setTimeout(() => {
        mouseParticleActive = false;
        document.removeEventListener('mousemove', handler);
      }, gameData.activeEffects['mouse-particles'] - Date.now());
    }

    // PWA Completa - Funciones
    let cloudSyncEnabled = false;
    let deviceId = localStorage.getItem('device-id') || generateDeviceId();
    let lastSyncTime = 0;
    
    function generateDeviceId() {
      const id = 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
      localStorage.setItem('device-id', id);
      return id;
    }
    
    function initCompletePWA() {
      console.log('üì± PWA Completa inicializada');
      
      // Detectar modo standalone
      if (window.matchMedia('(display-mode: standalone)').matches) {
        document.body.classList.add('pwa-standalone');
        checkAchievement('pwa-user');
      }
      
      // Manejar cambios de conectividad
      window.addEventListener('online', () => {
        showAchievementNotification({ name: 'üåê Conexi√≥n restaurada - Sincronizando...', points: 0 });
        syncToCloud();
      });
      
      window.addEventListener('offline', () => {
        showAchievementNotification({ name: 'üö´ Modo offline activado', points: 0 });
      });
      
      // Prevenir zoom en PWA
      if (window.matchMedia('(display-mode: standalone)').matches) {
        document.addEventListener('touchstart', function(e) {
          if (e.touches.length > 1) e.preventDefault();
        }, { passive: false });
      }
    }
    
    function detectAppStore() {
      const userAgent = navigator.userAgent;
      let store = 'web';
      
      if (userAgent.includes('wv') && userAgent.includes('Android')) {
        store = 'play-store';
      } else if (userAgent.includes('iPhone') && window.navigator.standalone) {
        store = 'app-store';
      }
      
      gameData.installSource = store;
      console.log('üì± Detectado:', store);
      
      if (store !== 'web') {
        checkAchievement('pwa-installer');
        addPoints(25);
      }
      
      saveGameData();
    }
    
    async function initCloudSync() {
      if (!navigator.onLine) return;
      
      try {
        // Intentar sincronizar datos existentes
        await syncFromCloud();
        cloudSyncEnabled = true;
        console.log('üåê Sync entre dispositivos habilitado');
        
        // Sincronizar cada 5 minutos
        setInterval(syncToCloud, 300000);
        
        // Sincronizar al cerrar/minimizar
        window.addEventListener('beforeunload', syncToCloud);
        window.addEventListener('visibilitychange', () => {
          if (document.hidden) syncToCloud();
        });
        
      } catch (error) {
        console.log('‚ö†Ô∏è Sync no disponible:', error.message);
      }
    }
    
    function showSyncIndicator(status) {
      const indicator = document.getElementById('sync-indicator');
      if (!indicator) return;
      
      indicator.classList.remove('syncing');
      
      if (status === 'syncing') {
        indicator.innerHTML = '<i class="bi bi-cloud-arrow-up"></i> Sincronizando...';
        indicator.classList.add('syncing', 'show');
      } else if (status === 'synced') {
        indicator.innerHTML = '<i class="bi bi-cloud-check"></i> Sincronizado';
        indicator.classList.add('show');
        setTimeout(() => indicator.classList.remove('show'), 2000);
      } else if (status === 'error') {
        indicator.innerHTML = '<i class="bi bi-cloud-slash"></i> Error sync';
        indicator.classList.add('show');
        setTimeout(() => indicator.classList.remove('show'), 3000);
      }
    }
    
    async function syncToCloud() {
      if (!cloudSyncEnabled || !navigator.onLine) return;
      
      showSyncIndicator('syncing');
      
      try {
        const syncData = {
          deviceId,
          timestamp: Date.now(),
          gameData: {
            points: gameData.points,
            achievements: gameData.achievements,
            streak: gameData.streak,
            unlockedThemes: Array.from(gameData.unlockedThemes),
            customColors: gameData.customColors,
            leaderboardName: gameData.leaderboardName
          }
        };
        
        // Usar localStorage como backup principal
        localStorage.setItem('fenix-cloud-backup', JSON.stringify(syncData));
        
        // Intentar sync real con GitHub Gist (opcional)
        const gistData = {
          description: 'FenixLab Sync Data',
          public: false,
          files: {
            'sync.json': {
              content: JSON.stringify(syncData)
            }
          }
        };
        
        lastSyncTime = Date.now();
        showSyncIndicator('synced');
        console.log('üíæ Datos sincronizados');
        
      } catch (error) {
        showSyncIndicator('error');
        console.log('‚ö†Ô∏è Error en sync:', error.message);
      }
    }
    
    async function syncFromCloud() {
      if (!navigator.onLine) return;
      
      try {
        // Cargar desde backup local primero
        const backup = localStorage.getItem('fenix-cloud-backup');
        if (backup) {
          const syncData = JSON.parse(backup);
          
          // Solo aplicar si es m√°s reciente
          if (syncData.timestamp > (gameData.lastSyncTime || 0)) {
            gameData.points = Math.max(gameData.points, syncData.gameData.points);
            gameData.streak = Math.max(gameData.streak, syncData.gameData.streak);
            
            // Sincronizar con achievementSystem
            if (window.achievementSystem) {
              achievementSystem.gameData.points = gameData.points;
              achievementSystem.gameData.streak = gameData.streak;
            }
            
            // Merge achievements
            Object.keys(syncData.gameData.achievements).forEach(key => {
              if (syncData.gameData.achievements[key]) {
                gameData.achievements[key] = true;
              }
            });
            
            // Merge unlocked themes
            syncData.gameData.unlockedThemes.forEach(theme => {
              gameData.unlockedThemes.add(theme);
            });
            
            gameData.lastSyncTime = syncData.timestamp;
            saveGameData();
            updatePointsDisplay();
            
            showAchievementNotification({ name: 'üíæ Datos sincronizados desde la nube', points: 0 });
          }
        }
        
      } catch (error) {
        console.log('‚ö†Ô∏è Error cargando sync:', error.message);
      }
    }
    
    // Leaderboard local solamente
    
    async function addToLeaderboard() {
      if (!gameData.leaderboardName) {
        showNamePanel();
        return;
      }
      
      // Actualizar en Firebase
      if (window.firebasePoints && window.firebasePoints.updateLeaderboard) {
        try {
          await window.firebasePoints.updateLeaderboard(gameData.leaderboardName, gameData.points);
        } catch (error) {
          console.warn('Error actualizando leaderboard en Firebase:', error);
        }
      }
      
      // Local backup
      const leaderboard = JSON.parse(localStorage.getItem('fenix-leaderboard') || '[]');
      const existing = leaderboard.findIndex(entry => entry.name === gameData.leaderboardName);
      
      if (existing >= 0) {
        leaderboard[existing].points = Math.max(leaderboard[existing].points, gameData.points);
      } else {
        leaderboard.push({ name: gameData.leaderboardName, points: gameData.points });
      }
      
      leaderboard.sort((a,b) => b.points - a.points);
      localStorage.setItem('fenix-leaderboard', JSON.stringify(leaderboard.slice(0,10)));
      
      updateLeaderboardDisplay();
    }
    
    async function syncGlobalLeaderboard() {
      // Solo usar datos locales ahora
      const localData = JSON.parse(localStorage.getItem('fenix-leaderboard') || '[]');
      localStorage.setItem('fenix-global-leaderboard', JSON.stringify(localData));
    }
    
    async function updateLeaderboardDisplay() {
      const container = document.getElementById('leaderboard-display');
      if (!container) return;
      
      let globalData = [];
      
      // Intentar obtener desde Firebase primero
      if (window.firebasePoints && window.firebasePoints.getLeaderboard) {
        try {
          globalData = await window.firebasePoints.getLeaderboard();
        } catch (error) {
          console.warn('Error obteniendo leaderboard de Firebase:', error);
        }
      }
      
      // Fallback a datos locales
      if (globalData.length === 0) {
        globalData = JSON.parse(localStorage.getItem('fenix-global-leaderboard') || '[]');
        if (globalData.length === 0) {
          globalData = JSON.parse(localStorage.getItem('fenix-leaderboard') || '[]');
        }
      }
      
      if (globalData.length === 0) {
        container.innerHTML = `
          <p style="font-size: 0.8rem; color: var(--text-secondary); text-align: center; padding: 1rem;">
            üèÜ S√© el primero en el leaderboard<br>
            <button onclick="showNamePanel()" class="btn btn-outline-neon" style="margin-top: 0.5rem; font-size: 0.7rem; padding: 0.3rem 0.6rem;">
              üìù Registrar Nombre
            </button>
          </p>
        `;
        return;
      }
      
      let html = '<div style="margin-bottom: 0.5rem;"><strong style="color: var(--primary);">üèÜ Top Global:</strong></div>';
      
      globalData.slice(0, 10).forEach((entry, index) => {
        const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
        const isMe = entry.name === gameData.leaderboardName || entry.userId === getUserId();
        const avatar = entry.avatar || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(entry.name || 'User') + '&background=random&size=128';
        
        html += `
          <div class="achievement-item ${isMe ? 'unlocked' : ''}" style="margin-bottom: 0.3rem; padding: 0.4rem; display: flex; align-items: center; gap: 0.5rem;">
            <div class="achievement-icon" style="font-size: 0.9rem;">${medal}</div>
            <img src="${avatar}" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(entry.name || 'User')}&background=random&size=128'" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary);" alt="Avatar">
            <div class="achievement-info" style="flex: 1;">
              <h4 style="font-size: 0.75rem;">${entry.name || 'An√≥nimo'} ${isMe ? '(T√∫)' : ''}</h4>
              <p style="font-size: 0.65rem;">${entry.points} pts</p>
            </div>
          </div>
        `;
      });
      
      // Bot√≥n para registrarse si no tiene nombre
      if (!gameData.leaderboardName) {
        html += `
          <div style="text-align: center; margin-top: 1rem;">
            <button onclick="showNamePanel()" class="btn btn-outline-neon" style="font-size: 0.7rem; padding: 0.3rem 0.6rem;">
              üìù Unirse al Leaderboard
            </button>
          </div>
        `;
      }
      
      container.innerHTML = html;
    }

    function showNamePanel() {
      document.getElementById('panel-overlay').classList.add('show');
      document.getElementById('name-panel').classList.add('show');
    }

    function hideNamePanel() {
      document.getElementById('panel-overlay').classList.remove('show');
      document.getElementById('name-panel').classList.remove('show');
      
      // Mostrar mensaje si no se registr√≥
      if (!gameData.leaderboardName) {
        setTimeout(() => {
          const msg = document.createElement('div');
          msg.style.cssText = 'position:fixed;bottom:20px;right:20px;background:var(--bg-dark);border:2px solid var(--primary);padding:1rem;border-radius:8px;z-index:9999;max-width:300px;box-shadow:0 4px 12px rgba(0,0,0,0.5);';
          msg.innerHTML = `
            <p style="margin:0 0 0.5rem;color:var(--text-primary);font-size:0.85rem;">üí° ¬øQuieres registrarte despu√©s?</p>
            <button onclick="showAchievements();toggleAchievementsView('leaderboard');this.parentElement.remove()" class="btn btn-outline-neon" style="width:100%;font-size:0.75rem;padding:0.4rem;">üèÜ Ir a Leaderboard</button>
            <button onclick="this.parentElement.remove()" style="background:transparent;border:none;color:var(--text-secondary);font-size:0.7rem;width:100%;margin-top:0.25rem;cursor:pointer;">Cerrar</button>
          `;
          document.body.appendChild(msg);
          setTimeout(() => msg.remove(), 10000);
        }, 500);
      }
    }

    async function submitName() {
      const nameInput = document.getElementById('name-input');
      const avatarInput = document.getElementById('avatar-input');
      const avatarFile = document.getElementById('avatar-file');
      const name = nameInput.value.trim();
      
      if (!name) {
        alert('Por favor ingresa un nombre v√°lido');
        return;
      }
      
      let avatar = avatarInput.value.trim();
      
      // Si hay archivo, subirlo a Firebase Storage
      if (avatarFile.files.length > 0) {
        const file = avatarFile.files[0];
        if (file.size > 2 * 1024 * 1024) {
          alert('‚ö†Ô∏è La imagen es muy grande. M√°ximo 2MB');
          return;
        }
        
        try {
          showAchievementNotification({ name: 'üíæ Subiendo foto...', points: 0 });
          if (window.firebasePoints && window.firebasePoints.uploadAvatar) {
            avatar = await window.firebasePoints.uploadAvatar(file);
          }
        } catch (error) {
          alert('‚ùå Error subiendo foto. Intenta con una URL en su lugar.');
          return;
        }
      }
      
      gameData.leaderboardName = name;
      gameData.avatar = avatar || '';
      localStorage.setItem('leaderboardName', name);
      localStorage.setItem('avatar', avatar);
      saveGameData();
      hideNamePanel();
      
      // Actualizar en Firebase
      if (window.firebasePoints && window.firebasePoints.updateLeaderboard) {
        window.firebasePoints.updateLeaderboard(name, gameData.points, avatar);
      }
      
      // Actualizar leaderboard local y global
      addToLeaderboard();
      
      // Mostrar notificaci√≥n
      showAchievementNotification({ 
        name: `üèÜ ¬°Bienvenido al leaderboard, ${name}!`, 
        points: 25 
      });
      addPoints(25);
    }

    // GitHub stats avanzadas
    async function updateGitHubStats() {
      try {
        const [userRes, reposRes] = await Promise.all([
          fetch(`https://api.github.com/users/${user}`),
          fetch(`https://api.github.com/users/${user}/repos?per_page=100`)
        ]);
        
        const userData = await userRes.json();
        const reposData = await reposRes.json();
        
        const totalStars = reposData.reduce((sum, repo) => sum + repo.stargazers_count, 0);
        
        gameData.githubStats = {
          followers: userData.followers,
          repos: userData.public_repos,
          stars: totalStars
        };
        
        // Logros basados en stats
        if (totalStars >= 50) checkAchievement('github-star');
        if (userData.followers >= 10) checkAchievement('github-popular');
        
        saveGameData();
      } catch (error) {
        console.log('Error loading GitHub stats:', error);
      }
    }

    function updateBadgesDisplay() {
      const container = document.getElementById('badges-display');
      if (!container) return;
      let html = '<h5 style="color: var(--primary); margin-bottom: 1rem;">üèÖ Badges/Medallas</h5>';
      Object.entries(gameData.badges).forEach(([id, badge]) => {
        const progress = Math.min(badge.level, badge.maxLevel);
        const percentage = (progress / badge.maxLevel) * 100;
        const isMaxed = badge.level >= badge.maxLevel;
        html += `
          <div class="badge-item ${isMaxed ? 'maxed' : ''}" style="margin-bottom: 1rem; padding: 0.75rem; background: var(--bg-dark); border-radius: 8px; border-left: 3px solid ${isMaxed ? 'var(--primary)' : 'var(--text-secondary)'}">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
              <h6 style="margin: 0; color: var(--text-primary); text-transform: capitalize;">${id.replace('-', ' ')}</h6>
              <span style="font-size: 0.8rem; color: var(--text-secondary);">${progress}/${badge.maxLevel}</span>
            </div>
            <div style="background: var(--bg-light); height: 8px; border-radius: 4px; overflow: hidden;">
              <div style="background: ${isMaxed ? 'var(--primary)' : 'var(--secondary)'}; height: 100%; width: ${percentage}%; transition: width 0.3s ease;"></div>
            </div>
            <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem; text-transform: capitalize;">${badge.category}</div>
          </div>
        `;
      });
      container.innerHTML = html;
    }
    
    function activateSpecialEvent(eventId, duration = 3600000) {
      // Fix: Inicializar specialEvents si no existe
      if (!gameData.specialEvents || typeof gameData.specialEvents !== 'object') {
        gameData.specialEvents = {
          'double-points': { active: false, endTime: null, multiplier: 2 },
          'theme-festival': { active: false, endTime: null, discount: 50 },
          'streak-boost': { active: false, endTime: null, bonus: 10 }
        };
      }
      
      achievementSystem.activateSpecialEvent(eventId, duration);
    }
    
    function updateSpecialEventsDisplay() {
      const container = document.getElementById('special-events');
      if (!container) return;
      
      // Fix: Verificar que specialEvents existe y no es null/undefined
      if (!gameData.specialEvents || typeof gameData.specialEvents !== 'object') {
        gameData.specialEvents = {
          'double-points': { active: false, endTime: null, multiplier: 2 },
          'theme-festival': { active: false, endTime: null, discount: 50 },
          'streak-boost': { active: false, endTime: null, bonus: 10 }
        };
        saveGameData();
      }
      
      const activeEvents = Object.entries(gameData.specialEvents).filter(([id, event]) => event && event.active);
      if (activeEvents.length === 0) {
        container.innerHTML = '';
        return;
      }
      let html = '<h5 style="color: var(--primary); margin-bottom: 1rem;">üé™ Eventos Especiales Activos</h5>';
      activeEvents.forEach(([id, event]) => {
        const timeLeft = Math.max(0, (event.endTime || 0) - Date.now());
        const minutes = Math.floor(timeLeft / 60000);
        const eventInfo = {
          'double-points': { name: 'Doble Puntos', icon: 'üî•', desc: `${event.multiplier || 2}x puntos` },
          'theme-festival': { name: 'Festival de Temas', icon: 'üéÜ', desc: `${event.discount || 50}% descuento` },
          'streak-boost': { name: 'Boost de Racha', icon: '‚ö°', desc: `+${event.bonus || 10} puntos extra` }
        };
        const info = eventInfo[id] || { name: 'Evento', icon: 'üé™', desc: 'Evento especial' };
        html += `
          <div class="event-item" style="margin-bottom: 0.5rem; padding: 0.75rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 8px; color: white;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <h6 style="margin: 0;">${info.icon} ${info.name}</h6>
                <p style="margin: 0; font-size: 0.8rem; opacity: 0.9;">${info.desc}</p>
              </div>
              <div style="text-align: right; font-size: 0.8rem;">
                <div>‚è±Ô∏è ${minutes}m</div>
              </div>
            </div>
          </div>
        `;
      });
      container.innerHTML = html;
    }
    
    function checkSpecialDates() {
      const now = new Date();
      const month = now.getMonth() + 1;
      const day = now.getDate();
      const hour = now.getHours();
      if ((now.getDay() === 6 || now.getDay() === 0) && !gameData.specialEvents['double-points'].active) {
        activateSpecialEvent('double-points', 24 * 60 * 60 * 1000);
      }
      if ((month === 12 && day === 25) || (month === 10 && day === 31) || (month === 2 && day === 14)) {
        if (!gameData.specialEvents['theme-festival'].active) {
          activateSpecialEvent('theme-festival', 24 * 60 * 60 * 1000);
        }
      }
      if (hour >= 19 && hour <= 21 && !gameData.specialEvents['streak-boost'].active) {
        activateSpecialEvent('streak-boost', 2 * 60 * 60 * 1000);
      }
    }
    
    // Timer para tiempo en sitio
    setInterval(async () => {
      gameData.timeOnSite += 1;
      updateChallenge('spend-time', 1);
      updateWeeklyChallenge('time-champion', 1);
      updateBadgeProgress('time-warrior', 1);
      
      if (gameData.timeOnSite >= 300) checkAchievement('time-master');
      if (gameData.timeOnSite >= 1800) checkAchievement('marathon-runner');
      if (gameData.timeOnSite % 300 === 0) addToLeaderboard();
      
      // Verificar eventos especiales cada minuto
      if (gameData.timeOnSite % 60 === 0) {
        checkSpecialDates();
      }
      
      saveGameData();
    }, 1000);

    function detectDeviceAndBrowser() {
      const isMobile = /Mobi|Android/i.test(navigator.userAgent);
      if (isMobile) checkAchievement('mobile-user');
      else checkAchievement('desktop-power');
      
      const browser = navigator.userAgent.includes('Chrome') ? 'chrome' :
        navigator.userAgent.includes('Firefox') ? 'firefox' :
        navigator.userAgent.includes('Safari') ? 'safari' : 'other';
      
      gameData.browsersUsed.add(browser);
      if (gameData.browsersUsed.size >= 3) checkAchievement('multi-browser');
      saveGameData();
    }

    function trackSocialClick(platform) {
      gameData.visitedSocials.add(platform);
      updateChallenge('social-visit');
      updateBadgeProgress('social', 1);
      if (gameData.visitedSocials.size >= 3) checkAchievement('social-butterfly');
      saveGameData();
    }

    function trackDemo(repo) {
      gameData.demosTested.add(repo);
      updateChallenge('demo-test');
      updateBadgeProgress('developer', 1);
      if (gameData.demosTested.size >= 5) checkAchievement('demo-master');
      saveGameData();
    }

    function trackCodeView(repo) {
      gameData.codeViewed.add(repo);
      updateChallenge('code-view');
      updateBadgeProgress('developer', 2);
      if (gameData.codeViewed.size >= 10) checkAchievement('code-reviewer');
      saveGameData();
    }



    document.addEventListener('DOMContentLoaded', async () => {
      loadGameData();
      updateDailyChallengesDisplay();
      updateWeeklyChallengesDisplay();
      updateBadgesDisplay();
      updateSpecialEventsDisplay();
      checkDailyVisit();
      checkTimeBasedAchievements();
      fetchRepos();
      updateGitHubStats();
      createParticles();
      typeWriterEffect();
      setupLazyLoading();
      setupParallax();
      setupPageTransitions();
      setupAchievements();
      
      // Desbloquear temas de eventos completados
      if (localStorage.getItem('plushie-theme-unlocked') === 'true') {
        gameData.unlockedThemes.add('plushie-rain');
      }
      if (localStorage.getItem('valentine-theme-unlocked') === 'true') {
        gameData.unlockedThemes.add('valentines-love');
      }
      
      updatePremiumThemes();
      updateSeasonalIndicator();
      updateCursorShop();
      setCursor(gameData.activeCursor);
      await updateLeaderboardDisplay();
      detectDeviceAndBrowser();
      
      // Preview de avatar
      const avatarFile = document.getElementById('avatar-file');
      const avatarPreview = document.getElementById('avatar-preview');
      const previewImg = document.getElementById('preview-img');
      
      if (avatarFile) {
        avatarFile.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              previewImg.src = e.target.result;
              avatarPreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
          }
        });
      }
      // Agregar listeners a redes sociales
      document.querySelectorAll('.social-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const href = e.target.closest('a').href;
          if (href.includes('github')) trackSocialClick('github');
          if (href.includes('twitter')) trackSocialClick('twitter');
          if (href.includes('tiktok')) trackSocialClick('tiktok');
        });
      });
      document.addEventListener('click', trackFastClicks);
      // Optimizaciones para m√≥viles
      if (/Mobi|Android/i.test(navigator.userAgent)) {
        // Deshabilitar efectos pesados
        document.getElementById('particles').style.display = 'none';
        document.getElementById('parallax-bg').style.display = 'none';
        
        // Deshabilitar Matrix Rain autom√°tico
        const originalCheckMatrix = checkMatrixTheme;
        checkMatrixTheme = () => {};
        
        // Reducir part√≠culas
        createParticles = () => {};
        
        // Simplificar animaciones
        document.documentElement.style.setProperty('--animation-speed', '0.1s');
        
        setInterval(() => {
          if (window.gc) window.gc();
        }, 30000);
      }
      checkMatrixTheme();
      // Verificar cada vez que cambie el tema
      const observer = new MutationObserver(() => {
        checkMatrixTheme();
      });
      observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
      if (gameData.pushNotifications) requestNotificationPermission();
      if (gameData.autoDayNight) {
        checkAutoDayNight();
        setInterval(checkAutoDayNight, 60000);
      }
      initCompletePWA();
      initCloudSync();
      setTimeout(checkForUpdates, 2000);
      setInterval(checkForUpdates, 300000);
      detectAppStore();
      let deferredPrompt;
      let installButton = null;
      window.addEventListener('beforeinstallprompt', (e) => {
        console.log('üì± PWA install prompt disponible');
        e.preventDefault();
        deferredPrompt = e;
      });
      function showInstallButton() {
        if (installButton) return;
        installButton = document.createElement('button');
        installButton.innerHTML = 'üì± Instalar App';
        installButton.style.cssText = 'position: fixed; bottom: 20px; left: 20px; z-index: 9999; background: var(--primary); color: white; border: none; padding: 0.75rem 1rem; border-radius: 8px; cursor: pointer; font-family: inherit; font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: none;';
        installButton.addEventListener('click', installPWA);
        document.body.appendChild(installButton);
        setTimeout(() => {
          if (installButton && deferredPrompt) {
            installButton.style.display = 'block';
            installButton.style.animation = 'pulse 2s infinite';
          }
        }, 10000);
      }
      async function installPWA() {
        if (!deferredPrompt) {
          console.log('‚ùå No hay prompt de instalaci√≥n disponible');
          return;
        }
        try {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log('üì± Resultado instalaci√≥n:', outcome);
          if (outcome === 'accepted') {
            showAchievementNotification({ name: 'üéâ App instalada correctamente!', points: 50 });
            addPoints(50);
            checkAchievement('pwa-installer');
          }
          deferredPrompt = null;
          if (installButton) {
            installButton.remove();
            installButton = null;
          }
        } catch (error) {
          console.error('‚ùå Error en instalaci√≥n PWA:', error);
        }
      }
      if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
        console.log('üì± Ejecut√°ndose como PWA');
        checkAchievement('pwa-user');
        deferredPrompt = null;
      }
      window.showPWAInstall = () => {
        if (deferredPrompt) {
          showInstallButton();
        } else {
          console.log('‚ùå No hay prompt de instalaci√≥n disponible');
        }
      };
      window.forceUpdate = () => {
        window.location.reload(true);
      };
      async function checkForUpdates() {
        try {
          const response = await fetch('./updates.json?t=' + Date.now());
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          const data = await response.json();
          const currentVersion = '2.4.2';
          if (data.version !== currentVersion) {
            console.log('üÜï Nueva versi√≥n disponible:', data.version);
            showUpdateNotification(data.version, data.updates[0]);
            if (window.matchMedia('(display-mode: standalone)').matches) {
              setTimeout(() => {
                if (confirm('üöÄ Nueva versi√≥n disponible. ¬øActualizar ahora?')) {
                  window.location.reload(true);
                }
              }, 3000);
            }
          }
        } catch (error) {
          console.log('‚ùå Error verificando actualizaciones:', error.message);
        }
      }
      function showUpdateNotification(newVersion, updateInfo) {
        const notification = document.getElementById('achievement-notification');
        const features = updateInfo?.features?.slice(0, 2).join(', ') || 'Nuevas mejoras';
        document.getElementById('notification-text').textContent = `üÜï v${newVersion}: ${features}`;
        notification.classList.add('show');
        notification.style.cursor = 'pointer';
        notification.onclick = () => {
          // Sincronizar antes de actualizar
          if (cloudSyncEnabled) syncToCloud();
          setTimeout(() => window.location.reload(true), 500);
        };
        setTimeout(() => {
          notification.classList.remove('show');
          notification.onclick = null;
          notification.style.cursor = '';
        }, 15000);
      }
      
      // Limpiar bot√≥n si la app se instala desde el navegador
      window.addEventListener('appinstalled', () => {
        console.log('üì± PWA instalada desde navegador');
        if (installButton) {
          installButton.remove();
          installButton = null;
        }
        checkAchievement('pwa-installer');
        addPoints(50);
      });

      // Animaci√≥n para el logo FenixLaboratory
      document.querySelector('.navbar-brand').addEventListener('click', (e) => {
        e.preventDefault();
        const brand = e.target.closest('.navbar-brand');
        brand.style.transform = 'scale(0.95)';
        brand.style.textShadow = '0 0 15px var(--primary)';
        
        // Ocultar cr√©ditos y actualizaciones si est√°n activos
        hideCredits();
        if (typeof hideUpdates === 'function') hideUpdates();
        
        setTimeout(() => {
          brand.style.transform = '';
          brand.style.textShadow = '';
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }, 150);
      });
      
      // Event listeners para updates
      document.getElementById('updates-btn').addEventListener('click', showUpdates);
      
      // Event listeners para temas
      initThemeListeners();
      
      // Event listeners para logros - ARREGLADO
      const achievementsBtn = document.getElementById('achievements-btn');
      if (achievementsBtn) {
        achievementsBtn.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          showAchievements();
        });
      }
      
      // Event listeners para checkboxes
      const autoSeasonalCheckbox = document.getElementById('auto-seasonal');
      if (autoSeasonalCheckbox) {
        autoSeasonalCheckbox.checked = gameData.autoSeasonalThemes;
        autoSeasonalCheckbox.addEventListener('change', (e) => {
          gameData.autoSeasonalThemes = e.target.checked;
          saveGameData();
        });
      }
      
      const pushNotificationsCheckbox = document.getElementById('push-notifications');
      if (pushNotificationsCheckbox) {
        pushNotificationsCheckbox.checked = gameData.pushNotifications;
        pushNotificationsCheckbox.addEventListener('change', (e) => {
          gameData.pushNotifications = e.target.checked;
          if (e.target.checked) {
            requestNotificationPermission();
          }
          saveGameData();
        });
      }
      
      const autoDayNightCheckbox = document.getElementById('auto-day-night');
      if (autoDayNightCheckbox) {
        autoDayNightCheckbox.checked = gameData.autoDayNight;
        autoDayNightCheckbox.addEventListener('change', (e) => {
          gameData.autoDayNight = e.target.checked;
          if (e.target.checked) {
            checkAutoDayNight();
            setInterval(checkAutoDayNight, 60000); // Cada minuto
          }
          saveGameData();
        });
      }
      
      // Event listeners para cursores
      document.querySelectorAll('.cursor-item').forEach(item => {
        item.addEventListener('click', (e) => {
          const cursor = e.target.closest('.cursor-item').dataset.cursor;
          const cost = parseInt(item.dataset.cost) || 0;
          
          if (item.classList.contains('locked') && cost > 0) {
            if (buyCursor(cursor, cost)) {
              setCursor(cursor);
            } else {
              alert(`Necesitas ${cost} puntos para este cursor. Tienes ${gameData.points} puntos.`);
            }
          } else if (gameData.unlockedCursors.has(cursor)) {
            setCursor(cursor);
            updateCursorShop();
          }
        });
      });
      
      // Editor de temas avanzado
      document.getElementById('toggle-editor').addEventListener('click', () => {
        const editor = document.getElementById('theme-editor');
        editor.style.display = editor.style.display === 'none' ? 'block' : 'none';
      });
      
      document.getElementById('preview-theme').addEventListener('click', () => {
        applyEditorTheme(true);
      });
      
      document.getElementById('save-custom-theme').addEventListener('click', () => {
        applyEditorTheme(false);
        showAchievementNotification({ name: 'Tema personalizado guardado!', points: 25 });
        addPoints(25);
      });
      
      document.getElementById('reset-editor').addEventListener('click', () => {
        document.getElementById('editor-bg').value = '#1a1a1a';
        document.getElementById('editor-bg-light').value = '#2d2d2d';
        document.getElementById('editor-text').value = '#f0f0f0';
        document.getElementById('editor-text-sec').value = '#b0b0b0';
        document.getElementById('editor-primary').value = '#ff6b35';
        document.getElementById('editor-secondary').value = '#f7931e';
      });
      
      // Event listeners para mini panel de cr√©ditos
      document.getElementById('close-credits').addEventListener('click', hideCreditsPanel);
      
      function showCreditsPanel() {
        const panel = document.getElementById('credits-mini-panel');
        panel.classList.add('show');
        // Aplicar estilos del tema FunkyAtlas al panel
        if (document.body.classList.contains('funkyatlas-theme')) {
          panel.style.background = 'linear-gradient(135deg, rgba(43, 16, 85, 0.9), rgba(117, 151, 222, 0.6))';
          panel.style.borderColor = '#ff4444';
          panel.style.backdropFilter = 'blur(15px)';
        }
        setTimeout(() => {
          hideCreditsPanel();
        }, 5000); // Auto-cerrar despu√©s de 5 segundos
      }
      
      function hideCreditsPanel() {
        document.getElementById('credits-mini-panel').classList.remove('show');
      }
      document.getElementById('credits-btn').addEventListener('click', showCredits);
      document.getElementById('nerd-btn').addEventListener('click', showNerdPanel);
      document.getElementById('close-panel').addEventListener('click', hideNerdPanel);
      document.getElementById('close-name-panel').addEventListener('click', hideNamePanel);
      document.getElementById('panel-overlay').addEventListener('click', (e) => {
        if (e.target === document.getElementById('panel-overlay')) {
          hideNerdPanel();
          hideNamePanel();
        }
      });
      
      // Animaci√≥n para enlaces de navegaci√≥n
      document.querySelectorAll('.nav-link').forEach(link => {
        if (link.id !== 'theme-panel-btn' && link.id !== 'credits-btn' && link.id !== 'updates-btn' && link.id !== 'achievements-btn') {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const target = e.target.closest('.nav-link');
            const href = target.getAttribute('href');
            
            // Ocultar cr√©ditos y actualizaciones si est√°n activos
            hideCredits();
            if (typeof hideUpdates === 'function') hideUpdates();
            
            if (href && href !== '#') {
              target.style.transform = 'scale(0.95)';
              target.style.textShadow = '0 0 15px var(--primary)';
              
              setTimeout(() => {
                target.style.transform = '';
                target.style.textShadow = '';
                document.querySelector(href).scrollIntoView({ behavior: 'smooth' });
              }, 150);
            }
          });
        }
      });
      
      // Animaci√≥n para bot√≥n Ver Proyectos
      document.querySelector('.hero .btn-neon').addEventListener('click', (e) => {
        e.preventDefault();
        const btn = e.target.closest('.btn-neon');
        btn.style.transform = 'scale(0.95)';
        btn.style.boxShadow = '0 0 30px var(--primary)';
        
        setTimeout(() => {
          btn.style.transform = '';
          btn.style.boxShadow = '';
          document.querySelector('#proyectos').scrollIntoView({ behavior: 'smooth' });
        }, 150);
      });

      // Filtros
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          e.target.classList.add('active');
          filterRepos(e.target.dataset.filter);
          trackFilter();
        });
      });

      // B√∫squeda
      document.getElementById('search-input').addEventListener('input', (e) => {
        searchRepos(e.target.value);
        if (e.target.value.length > 2) {
          trackSearch();
          updateChallenge('use-search');
        }
      });

      // Ordenamiento
      document.getElementById('sort-select').addEventListener('change', (e) => {
        sortRepos(e.target.value);
        trackFilter();
      });

      // Scroll tracking
      window.addEventListener('scroll', checkScrollToBottom);

      window.addEventListener('scroll', updateActiveNav);
      updateActiveNav();
    });

  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>
